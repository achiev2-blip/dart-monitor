<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DART â€” PREDICTION TRACKER</title>
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=IBM+Plex+Sans+KR:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <style>
        /* â”€â”€â”€ ê¸°ë³¸ ë‹¤í¬ í…Œë§ˆ â”€â”€â”€ */
        :root {
            --bg: #0a0a0f;
            --surface: #12121a;
            --border: #1e1e2e;
            --text: #e8e8f0;
            --muted: #6e6e8a;
            --accent: #7c3aed;
            --green: #22c55e;
            --red: #ef4444;
            --yellow: #f0c040;
            --blue: #3b82f6;
            --orange: #f97316;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'IBM Plex Sans KR', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* â”€â”€â”€ í—¤ë” â”€â”€â”€ */
        header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .logo {
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            font-weight: 700;
            color: var(--accent);
            letter-spacing: 2px;
        }

        .nav-link {
            text-decoration: none;
            color: var(--muted);
            font-size: 11px;
            font-family: 'JetBrains Mono', monospace;
            transition: color .2s;
        }

        .nav-link:hover {
            color: var(--text);
        }

        .divider {
            width: 1px;
            height: 16px;
            background: var(--border);
        }

        /* â”€â”€â”€ ë©”ì¸ â”€â”€â”€ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* â”€â”€â”€ í†µê³„ ì¹´ë“œ â”€â”€â”€ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .stat-label {
            font-size: 11px;
            color: var(--muted);
            margin-bottom: 6px;
            font-family: 'JetBrains Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-sub {
            font-size: 11px;
            color: var(--muted);
            margin-top: 4px;
        }

        /* â”€â”€â”€ ì„¹ì…˜ â”€â”€â”€ */
        .section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            border-bottom: 1px solid var(--border);
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .section-body {
            padding: 0;
        }

        /* â”€â”€â”€ ì˜ˆì¸¡ ì¹´ë“œ â”€â”€â”€ */
        .pred-item {
            display: grid;
            grid-template-columns: 60px 1fr 80px 80px 70px;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
            transition: background .15s;
        }

        .pred-item:hover {
            background: rgba(124, 58, 237, .06);
        }

        .pred-item:last-child {
            border-bottom: none;
        }

        .direction {
            font-size: 20px;
            font-weight: 700;
            text-align: center;
            font-family: 'JetBrains Mono', monospace;
        }

        .dir-up {
            color: var(--red);
        }

        .dir-down {
            color: var(--blue);
        }

        .dir-flat {
            color: var(--muted);
        }

        .pred-info .name {
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 2px;
        }

        .pred-info .detail {
            font-size: 11px;
            color: var(--muted);
        }

        .pred-meta {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            text-align: right;
        }

        /* â”€â”€â”€ ì ìˆ˜ ë°” â”€â”€â”€ */
        .score-bar {
            position: relative;
            height: 22px;
            background: rgba(255, 255, 255, .05);
            border-radius: 4px;
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            border-radius: 4px;
            transition: width .4s;
        }

        .score-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            font-weight: 700;
        }

        /* â”€â”€â”€ ë°°ì§€ â”€â”€â”€ */
        .badge {
            display: inline-block;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
        }

        .badge-correct {
            background: rgba(34, 197, 94, .15);
            color: var(--green);
        }

        .badge-wrong {
            background: rgba(239, 68, 68, .15);
            color: var(--red);
        }

        .badge-active {
            background: rgba(124, 58, 237, .15);
            color: var(--accent);
        }

        .badge-high {
            background: rgba(239, 68, 68, .15);
            color: var(--red);
        }

        .badge-medium {
            background: rgba(249, 115, 22, .15);
            color: var(--orange);
        }

        .badge-low {
            background: rgba(107, 114, 128, .15);
            color: var(--muted);
        }

        /* â”€â”€â”€ ë²„íŠ¼ â”€â”€â”€ */
        .btn {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            padding: 6px 14px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background: var(--surface);
            color: var(--text);
            cursor: pointer;
            transition: all .2s;
        }

        .btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .btn-primary {
            background: var(--accent);
            border-color: var(--accent);
            color: #fff;
        }

        .btn-primary:hover {
            background: #6d28d9;
        }

        /* â”€â”€â”€ íƒ­ â”€â”€â”€ */
        .tabs {
            display: flex;
            gap: 2px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }

        .tab {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            padding: 6px 14px;
            border-radius: 4px;
            cursor: pointer;
            color: var(--muted);
            transition: all .2s;
            border: 1px solid transparent;
        }

        .tab:hover {
            color: var(--text);
        }

        .tab.active {
            background: rgba(124, 58, 237, .12);
            color: var(--accent);
            border-color: rgba(124, 58, 237, .3);
        }

        /* â”€â”€â”€ ë¹ˆ ìƒíƒœ â”€â”€â”€ */
        .empty {
            text-align: center;
            padding: 40px;
            color: var(--muted);
            font-size: 13px;
        }

        /* â”€â”€â”€ ì¢…ëª©ë³„ í…Œì´ë¸” â”€â”€â”€ */
        .stock-table {
            width: 100%;
            border-collapse: collapse;
        }

        .stock-table th,
        .stock-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
            font-size: 12px;
        }

        .stock-table th {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stock-table tr:hover td {
            background: rgba(124, 58, 237, .04);
        }

        /* â”€â”€â”€ ë¡œë”© â”€â”€â”€ */
        .loading {
            text-align: center;
            padding: 30px;
            color: var(--muted);
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin .8s linear infinite;
            margin-left: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* â”€â”€â”€ ë°˜ì‘í˜• â”€â”€â”€ */
        @media (max-width: 768px) {
            .pred-item {
                grid-template-columns: 40px 1fr 60px;
            }

            .pred-item> :nth-child(4),
            .pred-item> :nth-child(5) {
                display: none;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>

<body>

    <!-- í—¤ë” -->
    <header>
        <a href="/" class="nav-link">ğŸ“Š DART</a>
        <div class="divider"></div>
        <a href="/us_market.html" class="nav-link">ğŸ‡ºğŸ‡¸ US</a>
        <div class="divider"></div>
        <a href="/context.html" class="nav-link">ğŸ§  CTX</a>
        <div class="divider"></div>
        <a href="/stocks.html" class="nav-link">ğŸ“ˆ STOCK</a>
        <div class="divider"></div>
        <a href="/archive.html" class="nav-link">ğŸ“¦ ARC</a>
        <div class="divider"></div>
        <div class="logo">ğŸ¯ PREDICTION TRACKER</div>
    </header>

    <div class="container">

        <!-- í†µê³„ ì¹´ë“œ -->
        <div class="stats-grid" id="statsGrid">
            <div class="loading">í†µê³„ ë¡œë”© ì¤‘</div>
        </div>

        <!-- íƒ­ -->
        <div class="tabs" id="mainTabs">
            <div class="tab active" data-tab="active" onclick="switchTab('active')">â³ ì§„í–‰ ì¤‘</div>
            <div class="tab" data-tab="evaluated" onclick="switchTab('evaluated')">âœ… í‰ê°€ ì™„ë£Œ</div>
            <div class="tab" data-tab="byStock" onclick="switchTab('byStock')">ğŸ“Š ì¢…ëª©ë³„</div>
            <div class="tab" data-tab="bySource" onclick="switchTab('bySource')">ğŸ·ï¸ ì¶œì²˜ë³„</div>
        </div>

        <!-- íƒ­ ë‚´ìš© -->
        <div class="section">
            <div class="section-header">
                <span id="sectionTitle">â³ ì§„í–‰ ì¤‘ì¸ ì˜ˆì¸¡</span>
                <button class="btn" onclick="runEvaluation()">ğŸ”„ ìˆ˜ë™ í‰ê°€</button>
            </div>
            <div class="section-body" id="tabContent">
                <div class="loading">ë°ì´í„° ë¡œë”© ì¤‘</div>
            </div>
        </div>

    </div>

    <script>
        // â”€â”€â”€ ë…ë¦½ API í˜¸ì¶œ â”€â”€â”€
        async function fetchAPI(url) {
            const resp = await fetch(url);
            if (!resp.ok) throw new Error(`API ì˜¤ë¥˜: ${resp.status}`);
            return resp.json();
        }

        let currentTab = 'active';
        let statsData = null;

        // â”€â”€â”€ ì´ˆê¸°í™” â”€â”€â”€
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadActive();
        });

        // â”€â”€â”€ í†µê³„ ë¡œë“œ â”€â”€â”€
        async function loadStats() {
            try {
                const data = await fetchAPI('/api/predictions/stats');
                statsData = data.stats;
                const t = statsData.total;
                const accuracy = t.evaluated > 0 ? t.accuracy || 0 : '-';
                const avgScore = t.evaluated > 0 ? t.avgScore || 0 : '-';

                document.getElementById('statsGrid').innerHTML = `
            <div class="stat-card">
                <div class="stat-label">ì´ ì˜ˆì¸¡</div>
                <div class="stat-value">${t.predictions}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">í‰ê°€ ì™„ë£Œ</div>
                <div class="stat-value">${t.evaluated}</div>
                <div class="stat-sub">${t.predictions > 0 ? Math.round(t.evaluated / t.predictions * 100) : 0}% í‰ê°€ë¨</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ë°©í–¥ ì ì¤‘ë¥ </div>
                <div class="stat-value" style="color: ${getAccuracyColor(accuracy)}">${accuracy}${typeof accuracy === 'number' ? '%' : ''}</div>
                <div class="stat-sub">${t.correct}/${t.evaluated} ì ì¤‘</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">í‰ê·  ì ìˆ˜</div>
                <div class="stat-value" style="color: ${getScoreColor(avgScore)}">${avgScore}</div>
                <div class="stat-sub">100ì  ë§Œì </div>
            </div>
        `;
            } catch (e) {
                document.getElementById('statsGrid').innerHTML = `<div class="empty">âš ï¸ í†µê³„ ë¡œë“œ ì‹¤íŒ¨: ${e.message}</div>`;
            }
        }

        // â”€â”€â”€ íƒ­ ì „í™˜ â”€â”€â”€
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tab));

            const titles = {
                active: 'â³ ì§„í–‰ ì¤‘ì¸ ì˜ˆì¸¡',
                evaluated: 'âœ… í‰ê°€ ì™„ë£Œëœ ì˜ˆì¸¡',
                byStock: 'ğŸ“Š ì¢…ëª©ë³„ í†µê³„',
                bySource: 'ğŸ·ï¸ ì¶œì²˜ë³„ í†µê³„'
            };
            document.getElementById('sectionTitle').textContent = titles[tab] || '';

            if (tab === 'active') loadActive();
            else if (tab === 'evaluated') loadEvaluated();
            else if (tab === 'byStock') renderByStock();
            else if (tab === 'bySource') renderBySource();
        }

        // â”€â”€â”€ í™œì„± ì˜ˆì¸¡ ë¡œë“œ â”€â”€â”€
        async function loadActive() {
            const el = document.getElementById('tabContent');
            el.innerHTML = '<div class="loading">ë¡œë”© ì¤‘</div>';
            try {
                const data = await fetchAPI('/api/predictions');
                if (!data.predictions || data.predictions.length === 0) {
                    el.innerHTML = '<div class="empty">ğŸ“­ ì§„í–‰ ì¤‘ì¸ ì˜ˆì¸¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                    return;
                }
                el.innerHTML = data.predictions.map(p => renderActivePred(p)).join('');
            } catch (e) {
                el.innerHTML = `<div class="empty">âš ï¸ ë¡œë“œ ì‹¤íŒ¨: ${e.message}</div>`;
            }
        }

        // â”€â”€â”€ í‰ê°€ ì™„ë£Œ ë¡œë“œ â”€â”€â”€
        async function loadEvaluated() {
            const el = document.getElementById('tabContent');
            el.innerHTML = '<div class="loading">ë¡œë”© ì¤‘</div>';
            try {
                const data = await fetchAPI('/api/predictions/evaluated?limit=100');
                if (!data.predictions || data.predictions.length === 0) {
                    el.innerHTML = '<div class="empty">ğŸ“­ í‰ê°€ëœ ì˜ˆì¸¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                    return;
                }
                el.innerHTML = data.predictions.map(p => renderEvalPred(p)).join('');
            } catch (e) {
                el.innerHTML = `<div class="empty">âš ï¸ ë¡œë“œ ì‹¤íŒ¨: ${e.message}</div>`;
            }
        }

        // â”€â”€â”€ í™œì„± ì˜ˆì¸¡ ë Œë”ë§ â”€â”€â”€
        function renderActivePred(p) {
            // í‘œì¤€ í˜•ì‹: prediction.direction / ì—‘ì…€ í˜•ì‹: direction ì§ì ‘
            const pred = p.prediction || {};
            const dir = pred.direction || p.direction || 'flat';
            const dirLabel = getDirectionLabel(dir);
            const dirClass = getDirectionClass(dir);
            const name = p.name || p.stockName || p.code || '?';
            const code = p.code || p.stockCode || '';
            const confidence = pred.confidence || p['ì‹ ë¢°ë„'] || 'medium';
            const targetPrice = pred.targetPrice || p.predictedPrice || null;
            const basePrice = pred.priceAtPrediction || p.previousClose || null;
            const timeframe = pred.timeframe || p.timeframe || '1d';
            const dueDate = p.dueDate || p.targetDate || '-';

            return `
        <div class="pred-item">
            <div class="direction ${dirClass}">${dirLabel}</div>
            <div class="pred-info">
                <div class="name">${name} <span style="color:var(--muted);font-size:11px">${code}</span></div>
                <div class="detail">
                    ê¸°ì¤€ê°€ ${formatPrice(basePrice)} â†’ ëª©í‘œ ${formatPrice(targetPrice)}
                    Â· <span class="badge badge-${confidence}">${confidence}</span>
                    Â· ${timeframe}
                </div>
            </div>
            <div class="pred-meta">${dueDate}</div>
            <div class="pred-meta"><span class="badge badge-active">ACTIVE</span></div>
            <div class="pred-meta">${p.source || '-'}</div>
        </div>
    `;
        }

        // â”€â”€â”€ í‰ê°€ ì™„ë£Œ ë Œë”ë§ â”€â”€â”€
        function renderEvalPred(p) {
            const pred = p.prediction || {};
            const ev = p.evaluation || {};

            // í‘œì¤€ í˜•ì‹ vs ì—‘ì…€ ë§ˆì´ê·¸ë ˆì´ì…˜ í˜•ì‹ ì²˜ë¦¬
            const dir = pred.direction || p.direction || 'flat';
            const dirLabel = getDirectionLabel(dir);
            const dirClass = getDirectionClass(dir);
            const name = p.name || p.stockName || p.code || '?';
            const code = p.code || p.stockCode || '';

            // í‰ê°€ ê²°ê³¼
            const correct = ev.directionCorrect;
            const score = ev.score || 0;
            const actualChange = ev.actualChange;
            const actualPrice = ev.actualPrice;
            const basePrice = pred.priceAtPrediction || p.previousClose || null;

            // ë‚ ì§œ
            const predDate = p.predictionDate || (p.createdAt ? p.createdAt.slice(0, 10) : '-');

            // ì—‘ì…€ ë§ˆì´ê·¸ë ˆì´ì…˜ í˜•ì‹ì¼ ê²½ìš° directionCorrectê°€ ì—†ì„ ìˆ˜ ìˆìŒ
            const hasEval = ev.directionCorrect !== undefined;

            return `
        <div class="pred-item">
            <div class="direction ${dirClass}">${dirLabel}</div>
            <div class="pred-info">
                <div class="name">
                    ${name}
                    <span style="color:var(--muted);font-size:11px">${code}</span>
                    ${hasEval ?
                    `<span class="badge ${correct ? 'badge-correct' : 'badge-wrong'}">${correct ? 'ì ì¤‘' : 'ë¯¸ì ì¤‘'}</span>` :
                    `<span class="badge" style="background:rgba(107,114,128,.15);color:var(--muted)">ë¯¸í‰ê°€</span>`
                }
                </div>
                <div class="detail">
                    ${formatPrice(basePrice)} â†’ ì‹¤ì œ ${formatPrice(actualPrice)}
                    ${actualChange !== null && actualChange !== undefined ?
                    `(<span style="color:${actualChange >= 0 ? 'var(--red)' : 'var(--blue)'}">
                            ${actualChange >= 0 ? '+' : ''}${actualChange}%
                        </span>)` : ''}
                    Â· ${predDate}
                </div>
            </div>
            <div class="pred-meta">${p.source || '-'}</div>
            <div>
                ${hasEval ? renderScoreBar(score) : '<span style="color:var(--muted);font-size:11px">-</span>'}
            </div>
            <div class="pred-meta" style="color:${getScoreColor(score)};font-weight:700">${hasEval ? score + 'ì ' : '-'}</div>
        </div>
    `;
        }

        // â”€â”€â”€ ì¢…ëª©ë³„ í†µê³„ â”€â”€â”€
        function renderByStock() {
            const el = document.getElementById('tabContent');
            if (!statsData || Object.keys(statsData.byStock).length === 0) {
                el.innerHTML = '<div class="empty">ğŸ“­ ì¢…ëª©ë³„ í†µê³„ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            const rows = Object.entries(statsData.byStock)
                .sort((a, b) => b[1].evaluated - a[1].evaluated)
                .map(([code, s]) => `
            <tr>
                <td style="font-weight:600">${s.name || code}</td>
                <td style="font-family:'JetBrains Mono',monospace">${code}</td>
                <td>${s.predictions}</td>
                <td>${s.evaluated}</td>
                <td style="color:${getAccuracyColor(s.accuracy || 0)};font-weight:600">
                    ${s.accuracy !== undefined ? s.accuracy + '%' : '-'}
                </td>
                <td>${s.correct || 0}</td>
                <td style="color:${getScoreColor(s.avgScore || 0)}">${s.avgScore || '-'}</td>
            </tr>
        `).join('');

            el.innerHTML = `
        <table class="stock-table">
            <thead><tr>
                <th>ì¢…ëª©</th><th>ì½”ë“œ</th><th>ì˜ˆì¸¡ ìˆ˜</th><th>í‰ê°€</th>
                <th>ì ì¤‘ë¥ </th><th>ì ì¤‘</th><th>í‰ê·  ì ìˆ˜</th>
            </tr></thead>
            <tbody>${rows}</tbody>
        </table>
    `;
        }

        // â”€â”€â”€ ì¶œì²˜ë³„ í†µê³„ â”€â”€â”€
        function renderBySource() {
            const el = document.getElementById('tabContent');
            if (!statsData) {
                el.innerHTML = '<div class="empty">ğŸ“­ ì¶œì²˜ë³„ í†µê³„ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            // ì¶œì²˜ë³„ + ê¸°ê°„ë³„ í•©ì¹¨
            const sections = [];

            if (Object.keys(statsData.bySource).length > 0) {
                const srcRows = Object.entries(statsData.bySource)
                    .map(([src, s]) => `
                <tr>
                    <td style="font-weight:600">ğŸ·ï¸ ${src}</td>
                    <td>${s.predictions}</td><td>${s.evaluated}</td>
                    <td style="color:${getAccuracyColor(s.accuracy || 0)};font-weight:600">${s.accuracy !== undefined ? s.accuracy + '%' : '-'}</td>
                    <td style="color:${getScoreColor(s.avgScore || 0)}">${s.avgScore || '-'}</td>
                </tr>
            `).join('');
                sections.push(srcRows);
            }

            if (Object.keys(statsData.byTimeframe).length > 0) {
                const tfRows = Object.entries(statsData.byTimeframe)
                    .map(([tf, s]) => `
                <tr>
                    <td style="font-weight:600">â±ï¸ ${tf}</td>
                    <td>${s.predictions}</td><td>${s.evaluated}</td>
                    <td style="color:${getAccuracyColor(s.accuracy || 0)};font-weight:600">${s.accuracy !== undefined ? s.accuracy + '%' : '-'}</td>
                    <td style="color:${getScoreColor(s.avgScore || 0)}">${s.avgScore || '-'}</td>
                </tr>
            `).join('');
                sections.push(tfRows);
            }

            if (sections.length === 0) {
                el.innerHTML = '<div class="empty">ğŸ“­ í†µê³„ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            el.innerHTML = `
        <table class="stock-table">
            <thead><tr>
                <th>êµ¬ë¶„</th><th>ì˜ˆì¸¡ ìˆ˜</th><th>í‰ê°€</th><th>ì ì¤‘ë¥ </th><th>í‰ê·  ì ìˆ˜</th>
            </tr></thead>
            <tbody>${sections.join('')}</tbody>
        </table>
    `;
        }

        // â”€â”€â”€ ìˆ˜ë™ í‰ê°€ ì‹¤í–‰ â”€â”€â”€
        async function runEvaluation() {
            if (!confirm('ë§Œê¸°ëœ ì˜ˆì¸¡ì„ ìˆ˜ë™ í‰ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            try {
                const resp = await fetch('/api/predictions/evaluate', { method: 'POST' });
                const data = await resp.json();
                if (data.ok) {
                    alert(`í‰ê°€ ì™„ë£Œ: ${data.result.evaluated}ê±´ í‰ê°€, ${data.result.errors}ê±´ ì˜¤ë¥˜`);
                    loadStats();
                    if (currentTab === 'active') loadActive();
                    else if (currentTab === 'evaluated') loadEvaluated();
                } else {
                    alert('í‰ê°€ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (e) {
                alert('í‰ê°€ ìš”ì²­ ì‹¤íŒ¨: ' + e.message);
            }
        }

        // â”€â”€â”€ ìœ í‹¸: ë°©í–¥ ë¼ë²¨/í´ë˜ìŠ¤ â”€â”€â”€
        function getDirectionLabel(dir) {
            // í•œê¸€ ë°©í–¥ ì²˜ë¦¬ (ì—‘ì…€ ë§ˆì´ê·¸ë ˆì´ì…˜)
            if (dir === 'up' || dir === 'ìƒìŠ¹') return 'â–²';
            if (dir === 'down' || dir === 'í•˜ë½') return 'â–¼';
            return 'â”';
        }

        function getDirectionClass(dir) {
            if (dir === 'up' || dir === 'ìƒìŠ¹') return 'dir-up';
            if (dir === 'down' || dir === 'í•˜ë½') return 'dir-down';
            return 'dir-flat';
        }

        // â”€â”€â”€ ìœ í‹¸: ê°€ê²© í¬ë§· â”€â”€â”€
        function formatPrice(p) {
            if (!p) return '-';
            return Number(p).toLocaleString() + 'ì›';
        }

        // â”€â”€â”€ ìœ í‹¸: ìƒ‰ìƒ â”€â”€â”€
        function getAccuracyColor(v) {
            if (typeof v !== 'number') return 'var(--muted)';
            if (v >= 70) return 'var(--green)';
            if (v >= 50) return 'var(--yellow)';
            return 'var(--red)';
        }

        function getScoreColor(v) {
            if (typeof v !== 'number') return 'var(--muted)';
            if (v >= 70) return 'var(--green)';
            if (v >= 50) return 'var(--yellow)';
            if (v >= 30) return 'var(--orange)';
            return 'var(--red)';
        }

        // â”€â”€â”€ ìœ í‹¸: ì ìˆ˜ ë°” â”€â”€â”€
        function renderScoreBar(score) {
            const color = score >= 70 ? 'var(--green)' : score >= 50 ? 'var(--yellow)' : score >= 30 ? 'var(--orange)' : 'var(--red)';
            return `
        <div class="score-bar">
            <div class="score-fill" style="width:${score}%;background:${color}"></div>
            <div class="score-text">${score}</div>
        </div>
    `;
        }
    </script>
</body>

</html>