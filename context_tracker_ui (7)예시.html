<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>êµ¬ë¦„ Â· CONTEXT TRACKER</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,300;0,400;0,500;1,300&family=IBM+Plex+Sans+KR:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg:     #0b0f12;
  --bg2:    #101518;
  --bg3:    #151c22;
  --bg4:    #1a2530;
  --border: #1e2d3a;
  --border2:#2a4055;
  --blue:   #5b9bc4;
  --blue2:  #3a6f9a;
  --text:   #d0e0ec;
  --text2:  #9ab8c8;
  --text3:  #6a8fa8;
  --green:  #4ea870;
  --green2: #2a5c3e;
  --yellow: #c4963c;
  --orange: #b8723a;
  --red:    #a84848;
  --dart:   #4488cc;
  --cloud:  #6aabcc;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'DM Mono', 'Courier New', monospace;
  font-size: 13px;
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* TOP BAR */
.topbar {
  background: var(--bg2);
  border-bottom: 1px solid var(--border);
  padding: 0 18px;
  height: 42px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-shrink: 0;
}
.topbar-left { display: flex; align-items: center; }
.dart-label { color: var(--dart); font-weight: 500; letter-spacing: 3px; font-size: 13px; padding-right: 14px; border-right: none; }
.market-pills { display: flex; padding: 0 14px; border-right: 1px solid var(--border); }
.mpill { display: flex; flex-direction: column; padding: 3px 12px; border-right: 1px solid var(--border); line-height: 1.3; }
.mpill:last-child { border-right: none; }
.mpill-label { font-size: 10px; color: var(--text3); letter-spacing: 1px; }
.mpill-val { font-size: 12px; color: var(--text); }
.mpill-val.up { color: var(--green); }
.mpill-val.dn { color: var(--red); }
.mpill-chg { font-size: 10px; }
.mpill-chg.up { color: var(--green); }
.mpill-chg.dn { color: var(--red); }
.tracker-title { padding-left: 14px; font-size: 12px; color: var(--cloud); letter-spacing: 3px; font-weight: 500; display: flex; align-items: center; gap: 8px; }
.nav-icons { display: flex; align-items: center; gap: 4px; padding-left: 12px; border-left: 1px solid var(--border); margin-left: 4px; }
.nav-icon {
  display: flex; align-items: center; justify-content: center;
  width: 28px; height: 24px;
  background: transparent;
  border: 1px solid var(--border);
  border-radius: 3px;
  color: var(--text3);
  font-size: 13px;
  cursor: pointer;
  text-decoration: none;
  transition: all 0.15s;
  position: relative;
}
.nav-icon:hover { border-color: var(--border2); color: var(--text2); background: var(--bg3); }
.nav-icon:hover .nav-tooltip {
  opacity: 1;
  transform: translateY(0);
}
.nav-tooltip {
  position: absolute;
  top: 30px;
  left: 50%;
  transform: translateX(-50%) translateY(-4px);
  background: var(--bg4);
  border: 1px solid var(--border2);
  color: var(--text);
  font-size: 10px;
  padding: 3px 8px;
  border-radius: 3px;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: all 0.15s;
  z-index: 200;
  font-family: inherit;
  letter-spacing: 0.5px;
}
.live-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--green); box-shadow: 0 0 6px var(--green); animation: pulse 2s infinite; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }
.topbar-right { display: flex; align-items: center; gap: 8px; }
.ts-label { font-size: 11px; color: var(--text3); }
.btn-setting { background: var(--bg3); border: 1px solid var(--border2); color: var(--text2); border-radius: 3px; padding: 4px 12px; font-size: 11px; cursor: pointer; font-family: inherit; }

/* TAB BAR */
.tabbar { background: var(--bg2); border-bottom: 1px solid var(--border); padding: 6px 14px; display: flex; align-items: center; gap: 5px; overflow-x: auto; scrollbar-width: thin; scrollbar-color: var(--border2) transparent; flex-shrink: 0; }
.tabbar::-webkit-scrollbar { height: 3px; }
.tabbar::-webkit-scrollbar-thumb { background: var(--border2); }
.btn-add { background: #112234; border: 1px solid var(--border2); color: var(--blue); border-radius: 3px; padding: 3px 10px; font-size: 11px; cursor: pointer; font-family: inherit; white-space: nowrap; flex-shrink: 0; }
.search-input { background: var(--bg3); border: 1px solid var(--border); color: var(--text); border-radius: 3px; padding: 3px 10px; font-size: 11px; font-family: inherit; outline: none; width: 140px; flex-shrink: 0; }
.search-input::placeholder { color: var(--text3); }
.tab-divider { width: 1px; height: 18px; background: var(--border); flex-shrink: 0; }
.stock-tab { display: inline-flex; align-items: center; gap: 4px; background: transparent; border: 1px solid var(--border); color: var(--text3); border-radius: 3px; padding: 3px 9px; font-size: 11px; cursor: pointer; font-family: inherit; white-space: nowrap; flex-shrink: 0; transition: all 0.1s; }
.stock-tab:hover { border-color: var(--border2); color: var(--text2); }
.stock-tab.active { background: var(--bg4); border-color: var(--border2); color: var(--blue); }
.stock-tab .chg { font-size: 10px; }
.stock-tab .chg.up { color: var(--green); }
.stock-tab .chg.dn { color: var(--red); }
.stock-tab .x { color: var(--text3); font-size: 11px; margin-left: 1px; cursor: pointer; }
.stock-tab .x:hover { color: var(--red); }
.kospi-badge { margin-left: auto; flex-shrink: 0; font-size: 11px; color: var(--text3); letter-spacing: 2px; }

/* LAYOUT */
.layout { display: grid; grid-template-columns: 1fr 480px; flex: 1; overflow: hidden; min-height: 0; }

/* PANELS */
.left-panel { overflow-y: auto; padding: 14px; display: flex; flex-direction: column; gap: 12px; scrollbar-width: thin; scrollbar-color: var(--border) transparent; }
.left-panel::-webkit-scrollbar { width: 4px; }
.left-panel::-webkit-scrollbar-thumb { background: var(--border); }
.right-panel { border-left: 1px solid var(--border); overflow-y: auto; display: flex; flex-direction: column; scrollbar-width: thin; scrollbar-color: var(--border) transparent; }
.right-panel::-webkit-scrollbar { width: 4px; }
.right-panel::-webkit-scrollbar-thumb { background: var(--border); }

/* CARD */
.card { background: var(--bg2); border: 1px solid var(--border); border-radius: 5px; overflow: hidden; }
.card-header { display: flex; justify-content: space-between; align-items: center; padding: 8px 14px; background: var(--bg3); border-bottom: 1px solid var(--border); }
.card-title { font-size: 11px; letter-spacing: 1.5px; color: var(--text2); display: flex; align-items: center; gap: 8px; }
.card-actions { display: flex; gap: 6px; }
.btn-sm { background: transparent; border: 1px solid var(--border); color: var(--text3); border-radius: 3px; padding: 2px 8px; font-size: 10px; cursor: pointer; font-family: inherit; transition: all 0.1s; }
.btn-sm:hover { border-color: var(--border2); color: var(--text2); }

/* TAGS */
.tag { font-size: 9px; padding: 1px 6px; border-radius: 2px; letter-spacing: 1px; border: 1px solid; }
.tag.dart  { color: var(--dart);   border-color: var(--blue2);  background: #0f2035; }
.tag.news  { color: var(--yellow); border-color: #4a3810;       background: #1c150a; }
.tag.rpt   { color: var(--green);  border-color: var(--green2); background: #0a1e12; }
.tag.ai    { color: var(--cloud);  border-color: #2a4858;       background: #0a1c28; }

/* MARKET OVERVIEW */
.market-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1px; background: var(--border); }
.mbox { background: var(--bg2); padding: 14px 14px; display: flex; flex-direction: column; gap: 4px; min-height: 70px; }
.mbox-bar { height: 2px; background: var(--border); border-radius: 1px; margin-top: 4px; overflow: hidden; }
.mbox-main { font-size: 15px; font-weight: 500; }
.mbox-label { font-size: 10px; color: var(--text2); letter-spacing: 1px; }
.mbox-main.up { color: var(--green); }
.mbox-main.dn { color: var(--red); }
.mbox-main.neu { color: var(--text); }
.mbox-sub { display: flex; gap: 8px; font-size: 11px; }
.mbox-chg.up { color: var(--green); }
.mbox-chg.dn { color: var(--red); }
.mbox-vol { color: var(--text2); }
.mbox-bar { height: 2px; background: var(--border); border-radius: 1px; margin-top: 4px; overflow: hidden; }
.mbox-bar-fill { height: 100%; border-radius: 1px; }
.mbox-bar-fill.up { background: var(--green); }
.mbox-bar-fill.dn { background: var(--red); }

/* WATCHLIST */
.wl-scroll { max-height: 320px; overflow-y: auto; scrollbar-width: thin; scrollbar-color: var(--border2) transparent; }
.wl-scroll::-webkit-scrollbar { width: 4px; }
.wl-scroll::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }
.wl-table { width: 100%; border-collapse: collapse; font-size: 12px; }
.wl-table thead th { position: sticky; top: 0; background: var(--bg3); z-index: 1; padding: 6px 10px; text-align: right; font-size: 11px; color: var(--text2); letter-spacing: 0.5px; border-bottom: 1px solid var(--border); font-weight: 500; white-space: nowrap; }
.wl-table thead th:first-child, .wl-table thead th:nth-child(2) { text-align: left; }
.wl-table tbody tr { border-bottom: 1px solid var(--border); cursor: pointer; transition: background 0.08s; }
.wl-table tbody tr:hover { background: var(--bg3); }
.wl-table tbody tr.row-active { background: var(--bg4); border-left: 2px solid var(--blue); }
.wl-table tbody tr:last-child { border-bottom: none; }
.wl-table td { padding: 6px 10px; text-align: right; color: var(--text); }
.wl-table td:first-child { text-align: left; color: var(--text2); font-size: 11px; }
.wl-table td:nth-child(2) { text-align: left; color: var(--text); }
.td-price { color: var(--text) !important; }
.td-chg.up { color: var(--green) !important; }
.td-chg.dn { color: var(--red) !important; }
.td-vol { color: var(--text2) !important; font-size: 11px; }
.wl-star { color: var(--yellow); margin-right: 3px; }
.signal-dot { display: inline-block; width: 6px; height: 6px; border-radius: 50%; margin-right: 2px; }
.signal-dot.dart { background: var(--dart); }
.signal-dot.news { background: var(--yellow); }
.signal-dot.rpt  { background: var(--green); }
.signal-dot.quiet { background: var(--border2); }
.wl-alert { font-size: 11px; }
.wl-alert.on { color: var(--yellow); }
.wl-alert.off { color: var(--text2); }

/* FEED */
.feed-item { display: flex; gap: 10px; padding: 8px 14px; border-bottom: 1px solid var(--border); cursor: pointer; transition: background 0.08s; }
.feed-item:hover { background: var(--bg3); }
.feed-item:last-child { border-bottom: none; }
.feed-time { font-size: 10px; color: var(--text2); white-space: nowrap; padding-top: 2px; min-width: 36px; }
.feed-body { flex: 1; min-width: 0; }
.feed-top { display: flex; align-items: center; gap: 6px; margin-bottom: 3px; }
.feed-ticker { font-size: 10px; color: var(--blue); background: #0f2035; border: 1px solid var(--blue2); border-radius: 2px; padding: 0 5px; }
.feed-title { font-size: 12px; color: var(--text); line-height: 1.4; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.feed-meta { font-size: 10px; color: var(--text2); display: flex; gap: 8px; margin-top: 2px; }
.feed-ai-badge { font-size: 9px; padding: 1px 5px; border-radius: 2px; border: 1px solid; }
.feed-ai-badge.pos { color: var(--green); border-color: var(--green2); background: #0a1e12; }
.feed-ai-badge.neg { color: var(--red);   border-color: #5a2222; background: #1a0a0a; }
.feed-ai-badge.neu { color: var(--text3); border-color: var(--border); background: var(--bg3); }

/* RIGHT PANEL â€” MARKET */
.rp-section { border-bottom: 1px solid var(--border); }
.rp-header { display: flex; justify-content: space-between; align-items: center; padding: 8px 14px; background: var(--bg3); border-bottom: 1px solid var(--border); }
.rp-title { font-size: 10px; letter-spacing: 2px; color: var(--text2); display: flex; align-items: center; gap: 6px; }
.cmd-card { background: #0d1508; }
.cmd-header { display: flex; justify-content: space-between; align-items: center; padding: 8px 14px; background: #121b0c; border-bottom: 1px solid #2a3818; }
.cmd-header-left { display: flex; align-items: center; gap: 7px; font-size: 10px; color: #8ab040; letter-spacing: 1.5px; }
.btn-add-cmd { background: #1e2e10; border: 1px solid #4a6028; color: #78a030; border-radius: 3px; padding: 2px 9px; font-size: 10px; cursor: pointer; font-family: inherit; }
.cmd-item { padding: 7px 14px; border-bottom: 1px solid #1e2c10; display: flex; align-items: flex-start; gap: 8px; background: #0d1508; }
.cmd-item:last-child { border-bottom: none; }
.cmd-num { font-size: 10px; color: #4a6028; padding-top: 1px; min-width: 16px; }
.cmd-text { font-size: 11px; color: #8ab040; line-height: 1.5; }
.ctx-body { padding: 10px 14px; }
.ctx-row { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid var(--border); }
.ctx-row:last-child { border-bottom: none; }
.ctx-key { font-size: 10px; color: var(--text2); }
.ctx-val { font-size: 10px; color: var(--text2); }
.ctx-val.ok { color: var(--green); }
.ctx-val.warn { color: var(--yellow); }
.ctx-bar-wrap { padding: 10px 14px; display: flex; flex-direction: column; gap: 8px; }
.ctx-bar-row { display: flex; flex-direction: column; gap: 3px; }
.ctx-bar-labels { display: flex; justify-content: space-between; font-size: 10px; color: var(--text2); }
.ctx-bar { height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; }
.ctx-bar-fill { height: 100%; border-radius: 2px; }
.ctx-bar-fill.green { background: var(--green); }
.ctx-bar-fill.yellow { background: var(--yellow); }
.ctx-bar-fill.blue { background: var(--blue); }
.ctx-bar-fill.dart { background: var(--dart); }
.gemini-body { padding: 8px 14px; display: flex; flex-direction: column; gap: 4px; }
.gm-row { display: flex; justify-content: space-between; align-items: center; padding: 4px 0; }
.gm-model { font-size: 10px; color: var(--text2); }
.gm-status { display: flex; align-items: center; gap: 5px; font-size: 10px; }
.gm-dot { width: 6px; height: 6px; border-radius: 50%; }
.gm-dot.ok   { background: var(--green); }
.gm-dot.warn { background: var(--yellow); }
.gm-dot.off  { background: var(--text3); }

/* RIGHT PANEL â€” STOCK DETAIL */
.stock-detail { display: flex; flex-direction: column; }
.sd-header { padding: 14px; background: var(--bg3); border-bottom: 1px solid var(--border); }
.sd-name-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
.sd-name { font-size: 15px; color: var(--text); font-weight: 500; }
.sd-code { font-size: 10px; color: var(--text2); margin-top: 3px; }
.sd-price-block { text-align: right; }
.sd-price { font-size: 20px; font-weight: 500; }
.sd-price.up { color: var(--green); }
.sd-price.dn { color: var(--red); }
.sd-chg { font-size: 11px; margin-top: 2px; }
.sd-chg.up { color: var(--green); }
.sd-chg.dn { color: var(--red); }
.sd-chart { height: 54px; position: relative; overflow: hidden; margin-bottom: 8px; }
.sd-chart svg { width: 100%; height: 100%; }
.sd-metrics { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1px; background: var(--border); border-top: 1px solid var(--border); margin: 0 -14px -14px; }
.sd-metric { background: var(--bg3); padding: 6px 8px; }
.sd-metric-label { font-size: 9px; color: var(--text2); }
.sd-metric-val { font-size: 12px; color: var(--text2); margin-top: 2px; }
.sd-supply { padding: 10px 14px; border-bottom: 1px solid var(--border); }
.sd-supply-title { font-size: 10px; color: var(--text2); letter-spacing: 1px; margin-bottom: 6px; }
.sd-supply-row { display: flex; justify-content: space-between; align-items: center; padding: 3px 0; }
.sd-supply-label { font-size: 10px; color: var(--text2); }
.sd-supply-val { font-size: 11px; }
.sd-supply-val.buy  { color: var(--green); }
.sd-supply-val.sell { color: var(--red); }
.sd-supply-bars { display: flex; height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; margin-top: 8px; }
.sd-supply-bar-buy  { background: var(--green); height: 100%; }
.sd-supply-bar-sell { background: var(--red);   height: 100%; }
.sd-ai { padding: 10px 14px; border-bottom: 1px solid var(--border); }
.sd-ai-label { font-size: 10px; color: var(--text2); letter-spacing: 1px; margin-bottom: 6px; }
.sd-ai-verdict { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 3px; font-size: 12px; margin-bottom: 7px; }
.sd-ai-verdict.pos { background: #0a1e12; border: 1px solid var(--green2); color: var(--green); }
.sd-ai-verdict.neg { background: #1a0a0a; border: 1px solid #5a2222; color: var(--red); }
.sd-ai-verdict.neu { background: var(--bg3); border: 1px solid var(--border); color: var(--text2); }
.sd-ai-text { font-size: 11px; color: var(--text2); line-height: 1.65; }
.sd-tabs { display: flex; border-bottom: 1px solid var(--border); background: var(--bg3); }
.sd-tab { flex: 1; padding: 7px 4px; font-size: 10px; text-align: center; color: var(--text3); cursor: pointer; border-right: 1px solid var(--border); letter-spacing: 0.5px; border-bottom: 2px solid transparent; transition: all 0.1s; }
.sd-tab:last-child { border-right: none; }
.sd-tab.active { color: var(--blue); border-bottom-color: var(--blue); background: var(--bg4); }
.sd-feed-item { padding: 8px 14px; border-bottom: 1px solid var(--border); cursor: pointer; transition: background 0.08s; }
.sd-feed-item:hover { background: var(--bg3); }
.sd-feed-item:last-child { border-bottom: none; }
.sd-feed-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 3px; }
.sd-feed-time { font-size: 10px; color: var(--text2); }
.sd-feed-title { font-size: 11px; color: var(--text); line-height: 1.45; }
.sd-feed-source { font-size: 10px; color: var(--text2); margin-top: 3px; }

/* AI ê·¼ê±° íŒ¨ë„ */
.ai-reason-item { padding: 10px 14px; border-bottom: 1px solid var(--border); }
.ai-reason-item:last-child { border-bottom: none; }
.ai-reason-top { display: flex; align-items: center; gap: 7px; margin-bottom: 5px; }
.ai-reason-icon { font-size: 11px; }
.ai-reason-label { font-size: 10px; letter-spacing: 1px; color: var(--text3); }
.ai-reason-badge { margin-left: auto; }
.ai-reason-body { font-size: 11px; color: var(--text2); line-height: 1.65; }
.ai-reason-body strong { color: var(--text); font-weight: 500; }
.ai-reason-body .neg { color: var(--red); }
.ai-reason-body .pos { color: var(--green); }
.ai-reason-body .neu { color: var(--yellow); }

/* ì¬ë¬´ í…Œì´ë¸” */
.fin-table { width: 100%; border-collapse: collapse; font-size: 11px; }
.fin-table th { padding: 6px 14px; text-align: right; font-size: 10px; color: var(--text3); border-bottom: 1px solid var(--border); font-weight: 400; }
.fin-table th:first-child { text-align: left; }
.fin-table td { padding: 6px 14px; text-align: right; color: var(--text2); border-bottom: 1px solid var(--border); }
.fin-table td:first-child { text-align: left; color: var(--text3); }
.fin-table tr:last-child td { border-bottom: none; }
.fin-table .up { color: var(--green); }
.fin-table .dn { color: var(--red); }

/* ì»¨ì„¼ì„œìŠ¤ */
.cons-item { padding: 9px 14px; border-bottom: 1px solid var(--border); display: flex; flex-direction: column; gap: 4px; }
.cons-item:last-child { border-bottom: none; }
.cons-top { display: flex; justify-content: space-between; align-items: center; }
.cons-firm { font-size: 10px; color: var(--text2); }
.cons-op { font-size: 10px; padding: 1px 7px; border-radius: 2px; border: 1px solid; }
.cons-op.buy  { color: var(--green); border-color: var(--green2); background: #0a1e12; }
.cons-op.hold { color: var(--yellow); border-color: #4a3810; background: #1c150a; }
.cons-op.sell { color: var(--red); border-color: #5a2222; background: #1a0a0a; }
.cons-tp { font-size: 12px; color: var(--text); }
.cons-analyst { font-size: 10px; color: var(--text2); }

.tab-content { display: none; }
.tab-content.active { display: block; }

::-webkit-scrollbar { width: 4px; height: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
</style>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
  <div class="topbar-left">
    <span class="dart-label">DART</span>

    <div class="tracker-title"><div class="live-dot"></div>êµ¬ë¦„&nbsp;Â·&nbsp;CONTEXT TRACKER</div>
    <div class="nav-icons">
      <a class="nav-icon" href="https://dart.fss.or.kr" target="_blank" title="">
        ğŸ“‹
        <span class="nav-tooltip">DART ê³µì‹œì‹œìŠ¤í…œ</span>
      </a>
      <a class="nav-icon" href="https://finance.yahoo.com/markets/" target="_blank" title="">
        ğŸ‡ºğŸ‡¸
        <span class="nav-tooltip">ë¯¸êµ­ ì¦ì‹œ</span>
      </a>
      <a class="nav-icon" href="#" onclick="goHome(); return false;" title="">
        âŒ‚
        <span class="nav-tooltip">CONTEXT TRACKER í™ˆ</span>
      </a>
      <a class="nav-icon" id="tg-btn" href="#" onclick="sendToTelegram(); return false;" title="">
        âœˆ
        <span class="nav-tooltip">í…”ë ˆê·¸ë¨ìœ¼ë¡œ ì „ì†¡</span>
      </a>
    </div>
  </div>
  <div class="topbar-right">
    <span class="ts-label" id="ts-label">2026-02-22 Â· ì¥í›„</span>
    <button class="btn-setting">âš™ ì„¤ì •</button>
  </div>
</div>

<!-- TAB BAR -->
<div class="tabbar">
  <button class="btn-add">+ ì¢…ëª©ì¶”ê°€</button>
  <input class="search-input" placeholder="ì¢…ëª©ëª… ë˜ëŠ” ì½”ë“œ...">
  <div class="tab-divider"></div>
  <div id="freq-tabs"></div>
  <span class="kospi-badge">54ì¢…ëª©</span>
</div>

<!-- LAYOUT -->
<div class="layout">
  <!-- LEFT -->
  <div class="left-panel">

    <div class="card">
      <div class="card-header">
        <div class="card-title"><span class="tag dart">MARKET</span> ì‹œì¥ ìš”ì•½ â€” 2026-02-21 ë§ˆê°</div>
        <div class="card-actions"><button class="btn-sm">ìƒˆë¡œê³ ì¹¨</button></div>
      </div>
      <div class="market-grid">
        <div class="mbox"><div class="mbox-label">KOSPI</div><div class="mbox-main up">2,651.6</div><div class="mbox-sub"><span class="mbox-chg up">+18.4</span><span class="mbox-chg up">+0.70%</span><span class="mbox-vol">485M</span></div><div class="mbox-bar"><div class="mbox-bar-fill up" style="width:70%"></div></div></div>
        <div class="mbox"><div class="mbox-label">KOSDAQ</div><div class="mbox-main dn">748.9</div><div class="mbox-sub"><span class="mbox-chg dn">-3.1</span><span class="mbox-chg dn">-0.41%</span><span class="mbox-vol">812M</span></div><div class="mbox-bar"><div class="mbox-bar-fill dn" style="width:35%"></div></div></div>
        <div class="mbox"><div class="mbox-label">ì™¸êµ­ì¸ ìˆœë§¤ìˆ˜</div><div class="mbox-main up">+1,248ì–µ</div><div class="mbox-sub"><span class="mbox-chg up">KOSPI</span><span class="mbox-vol">ê¸°ê´€ -382ì–µ</span></div><div class="mbox-bar"><div class="mbox-bar-fill up" style="width:62%"></div></div></div>
        <div class="mbox"><div class="mbox-label">USD/KRW</div><div class="mbox-main dn">1,434.2</div><div class="mbox-sub"><span class="mbox-chg dn">+2.5</span><span class="mbox-vol">+0.17%</span></div><div class="mbox-bar"><div class="mbox-bar-fill dn" style="width:55%"></div></div></div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-title"><span class="tag dart">WATCH</span> ê´€ì‹¬ì¢…ëª© â€” 54ì¢…ëª©</div>
        <div class="card-actions"><button class="btn-sm">ì •ë ¬</button><button class="btn-sm">í•„í„°</button></div>
      </div>
      <div class="wl-scroll">
      <table class="wl-table">
        <thead><tr><th>ì½”ë“œ</th><th>ì¢…ëª©ëª…</th><th>í˜„ì¬ê°€</th><th>ë“±ë½ë¥ </th><th>ê±°ë˜ëŸ‰</th><th>ì‹œê·¸ë„</th><th>ì•Œë¦¼</th></tr></thead>
        <tbody>
          <tr class="wl-row" data-stock="005930"><td>005930</td><td><span class="wl-star">â˜…</span>ì‚¼ì„±ì „ì</td><td class="td-price">56,100</td><td class="td-chg dn">â–¼ -0.62%</td><td class="td-vol">18.2M</td><td><span class="signal-dot news"></span><span class="signal-dot dart"></span></td><td><span class="wl-alert on">ğŸ””</span></td></tr>
          <tr class="wl-row" data-stock="000660"><td>000660</td><td>SKí•˜ì´ë‹‰ìŠ¤</td><td class="td-price">192,400</td><td class="td-chg up">â–² +1.20%</td><td class="td-vol">4.1M</td><td><span class="signal-dot dart"></span></td><td><span class="wl-alert on">ğŸ””</span></td></tr>
          <tr class="wl-row" data-stock="000210"><td>000210</td><td>DL</td><td class="td-price">45,600</td><td class="td-chg dn">â–¼ -0.88%</td><td class="td-vol">0.3M</td><td><span class="signal-dot quiet"></span></td><td><span class="wl-alert off">ğŸ”•</span></td></tr>
          <tr class="wl-row" data-stock="003490"><td>003490</td><td>ëŒ€í•œí•­ê³µ</td><td class="td-price">22,200</td><td class="td-chg up">â–² +0.45%</td><td class="td-vol">1.8M</td><td><span class="signal-dot news"></span></td><td><span class="wl-alert on">ğŸ””</span></td></tr>
          <tr class="wl-row" data-stock="003550"><td>003550</td><td>LG</td><td class="td-price">96,400</td><td class="td-chg dn">â–¼ -0.31%</td><td class="td-vol">0.2M</td><td><span class="signal-dot quiet"></span></td><td><span class="wl-alert off">ğŸ”•</span></td></tr>
          <tr class="wl-row" data-stock="003670"><td>003670</td><td>í¬ìŠ¤ì½”í“¨ì²˜ì— </td><td class="td-price">143,200</td><td class="td-chg up">â–² +2.10%</td><td class="td-vol">0.9M</td><td><span class="signal-dot news"></span><span class="signal-dot dart"></span></td><td><span class="wl-alert on">ğŸ””</span></td></tr>
          <tr class="wl-row" data-stock="009830"><td>009830</td><td>í•œí™”ì†”ë£¨ì…˜</td><td class="td-price">25,450</td><td class="td-chg dn">â–¼ -1.55%</td><td class="td-vol">1.5M</td><td><span class="signal-dot news"></span></td><td><span class="wl-alert on">ğŸ””</span></td></tr>
          <tr class="wl-row" data-stock="010060"><td>010060</td><td>OCIí™€ë”©ìŠ¤</td><td class="td-price">89,500</td><td class="td-chg up">â–² +0.90%</td><td class="td-vol">0.2M</td><td><span class="signal-dot quiet"></span></td><td><span class="wl-alert off">ğŸ”•</span></td></tr>
          <tr class="wl-row" data-stock="011000"><td>011000</td><td>íŒŒë¯¸ì…€</td><td class="td-price">7,840</td><td class="td-chg up">â–² +3.40%</td><td class="td-vol">4.6M</td><td><span class="signal-dot dart"></span></td><td><span class="wl-alert on">ğŸ””</span></td></tr>
          <tr class="wl-row" data-stock="011070"><td>011070</td><td>LGì´ë…¸í…</td><td class="td-price">128,600</td><td class="td-chg dn">â–¼ -0.70%</td><td class="td-vol">0.3M</td><td><span class="signal-dot quiet"></span></td><td><span class="wl-alert off">ğŸ”•</span></td></tr>
          <tr class="wl-row" data-stock="012630"><td>012630</td><td>HDC</td><td class="td-price">8,120</td><td class="td-chg up">â–² +1.05%</td><td class="td-vol">0.5M</td><td><span class="signal-dot news"></span></td><td><span class="wl-alert off">ğŸ”•</span></td></tr>
          <tr class="wl-row" data-stock="009150"><td>009150</td><td>ì‚¼ì„±ì „ê¸°</td><td class="td-price">142,000</td><td class="td-chg dn">â–¼ -0.22%</td><td class="td-vol">0.4M</td><td><span class="signal-dot quiet"></span></td><td><span class="wl-alert off">ğŸ”•</span></td></tr>
          <tr class="wl-row" data-stock="086790"><td>086790</td><td>í•˜ë‚˜ê¸ˆìœµì§€ì£¼</td><td class="td-price">58,200</td><td class="td-chg up">â–² +0.33%</td><td class="td-vol">0.6M</td><td><span class="signal-dot quiet"></span></td><td><span class="wl-alert off">ğŸ”•</span></td></tr>
          <tr class="wl-row" data-stock="010780"><td>010780</td><td>ì•„ì´ì—ìŠ¤ë™ì„œ</td><td class="td-price">32,100</td><td class="td-chg dn">â–¼ -0.50%</td><td class="td-vol">0.1M</td><td><span class="signal-dot quiet"></span></td><td><span class="wl-alert off">ğŸ”•</span></td></tr>
          <tr class="wl-row" data-stock="000215"><td>000215</td><td>DLìš°</td><td class="td-price">38,200</td><td class="td-chg dn">â–¼ -1.14%</td><td class="td-vol">0.1M</td><td><span class="signal-dot quiet"></span></td><td><span class="wl-alert off">ğŸ”•</span></td></tr>
        </tbody>
      </table>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-title">
          <span class="tag news">FEED</span> ì‹¤ì‹œê°„ ë‰´ìŠ¤ Â· ê³µì‹œ í”¼ë“œ
          <span id="server-status" style="font-size:9px;padding:1px 7px;border-radius:2px;border:1px solid var(--border);color:var(--text3);margin-left:4px;">ì—°ê²° í™•ì¸ ì¤‘...</span>
        </div>
        <div class="card-actions">
          <button class="btn-sm" onclick="filterFeed('all')">ì „ì²´</button>
          <button class="btn-sm" onclick="filterFeed('dart')">ê³µì‹œ</button>
          <button class="btn-sm" onclick="filterFeed('news')">ë‰´ìŠ¤</button>
          <button class="btn-sm" onclick="filterFeed('rpt')">ë¦¬í¬íŠ¸</button>
          <button class="btn-sm" onclick="loadLiveFeed()" style="color:var(--blue)">â†»</button>
        </div>
      </div>
      <div id="live-feed-container" style="max-height:400px;overflow-y:auto;">
        <div style="padding:20px 14px;text-align:center;color:var(--text3);font-size:11px;">ì„œë²„ ì—°ê²° ì¤‘...</div>
      </div>
    </div>

  </div>

  <!-- RIGHT -->
  <div class="right-panel" id="right-panel">

    <!-- MARKET MODE -->
    <div id="rp-market">
      <div class="cmd-card">
        <div class="cmd-header">
          <div class="cmd-header-left">â˜ í´ë¡œë“œ ëª…ë ¹ì–´</div>
          <button class="btn-add-cmd">+ ì¶”ê°€</button>
        </div>
        <div class="cmd-item">
          <span class="cmd-num">1</span>
          <span class="cmd-text">ì§ì „ ê±°ë˜ì¼ ë§ˆê°ê°€ ê¸°ì¤€, í‘œ(Table) í¬ë§·ìœ¼ë¡œ ë‹µë³€</span>
        </div>
      </div>
      <div class="rp-section">
        <div class="rp-header"><div class="rp-title"><span class="tag ai">AI</span> ì»¨í…ìŠ¤íŠ¸ ìƒíƒœ</div><button class="btn-sm">ì´ˆê¸°í™”</button></div>
        <div class="ctx-body">
          <div class="ctx-row"><span class="ctx-key">ì„¸ì…˜</span><span class="ctx-val ok">í™œì„±</span></div>
          <div class="ctx-row"><span class="ctx-key">ëª¨ë¸</span><span class="ctx-val">Claude Sonnet 4.6</span></div>
          <div class="ctx-row"><span class="ctx-key">ë°ì´í„° ê¸°ì¤€</span><span class="ctx-val">2026-02-21 ë§ˆê°</span></div>
          <div class="ctx-row"><span class="ctx-key">ëª…ë ¹ì–´</span><span class="ctx-val ok">1ê°œ ì ìš©</span></div>
        </div>
      </div>
      <div class="rp-section">
        <div class="rp-header"><div class="rp-title">ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©ëŸ‰</div></div>
        <div class="ctx-bar-wrap">
          <div class="ctx-bar-row"><div class="ctx-bar-labels"><span>í˜„ì¬ ëŒ€í™”</span><span class="ctx-val ok">23%</span></div><div class="ctx-bar"><div class="ctx-bar-fill green" style="width:23%"></div></div></div>
          <div class="ctx-bar-row"><div class="ctx-bar-labels"><span>ì¢…ëª© ë°ì´í„°</span><span class="ctx-val">54ì¢…ëª©</span></div><div class="ctx-bar"><div class="ctx-bar-fill blue" style="width:68%"></div></div></div>
          <div class="ctx-bar-row"><div class="ctx-bar-labels"><span>ë‰´ìŠ¤ ìºì‹œ</span><span class="ctx-val warn">87%</span></div><div class="ctx-bar"><div class="ctx-bar-fill yellow" style="width:87%"></div></div></div>
          <div class="ctx-bar-row"><div class="ctx-bar-labels"><span>ë¦¬í¬íŠ¸ AI</span><span class="ctx-val">12/30</span></div><div class="ctx-bar"><div class="ctx-bar-fill dart" style="width:40%"></div></div></div>
        </div>
      </div>
      <div class="rp-section">
        <div class="rp-header"><div class="rp-title">Gemini AI ìƒíƒœ</div></div>
        <div class="gemini-body">
          <div class="gm-row"><span class="gm-model">Pro Flash (1ìˆœìœ„)</span><div class="gm-status"><div class="gm-dot ok"></div><span style="color:var(--green)">ì •ìƒ</span></div></div>
          <div class="gm-row"><span class="gm-model">Pro Lite (2ìˆœìœ„)</span><div class="gm-status"><div class="gm-dot ok"></div><span style="color:var(--green)">ëŒ€ê¸°</span></div></div>
          <div class="gm-row"><span class="gm-model">Free Flash (3ìˆœìœ„)</span><div class="gm-status"><div class="gm-dot warn"></div><span style="color:var(--yellow)">ëŒ€ê¸°</span></div></div>
          <div class="gm-row"><span class="gm-model">Free 8B (4ìˆœìœ„)</span><div class="gm-status"><div class="gm-dot off"></div><span style="color:var(--text3)">ì˜ˆë¹„</span></div></div>
        </div>
      </div>
      <div class="rp-section">
        <div class="rp-header"><div class="rp-title">ë°ì´í„° ì†ŒìŠ¤</div></div>
        <div class="gemini-body">
          <div class="gm-row"><span class="gm-model">WiseReport <span style="font-size:10px;color:var(--text3)">5ë¶„</span></span><div class="gm-status"><div class="gm-dot ok"></div><span style="color:var(--green);font-size:10px">04:12ì „</span></div></div>
          <div class="gm-row"><span class="gm-model">ë¯¸ë˜ì—ì…‹ <span style="font-size:10px;color:var(--text3)">3ë¶„</span></span><div class="gm-status"><div class="gm-dot ok"></div><span style="color:var(--green);font-size:10px">02:38ì „</span></div></div>
          <div class="gm-row"><span class="gm-model">í•˜ë‚˜ì¦ê¶Œ <span style="font-size:10px;color:var(--text3)">4ë¶„</span></span><div class="gm-status"><div class="gm-dot ok"></div><span style="color:var(--green);font-size:10px">01:55ì „</span></div></div>
          <div class="gm-row"><span class="gm-model">í˜„ëŒ€ì°¨ì¦ê¶Œ <span style="font-size:10px;color:var(--text3)">6ë¶„</span></span><div class="gm-status"><div class="gm-dot warn"></div><span style="color:var(--yellow);font-size:10px">05:42ì „</span></div></div>
          <div class="gm-row"><span class="gm-model">Naver <span style="font-size:10px;color:var(--text3)">10ë¶„</span></span><div class="gm-status"><div class="gm-dot ok"></div><span style="color:var(--green);font-size:10px">09:11ì „</span></div></div>
          <div class="gm-row"><span class="gm-model">ë§¤ê²½/ì—°í•©/í•œê²½ RSS</span><div class="gm-status"><div class="gm-dot ok"></div><span style="color:var(--green);font-size:10px">ì •ìƒ</span></div></div>
        </div>
      </div>
    </div>

    <!-- STOCK DETAIL MODE -->
    <div id="rp-stock" style="display:none;" class="stock-detail"></div>

  </div>
</div>

<script>
function goHome() {
  // ìš°ì¸¡ íŒ¨ë„ ì´ˆê¸°í™” â€” MARKET ëª¨ë“œë¡œ
  document.getElementById('rp-market').style.display = '';
  document.getElementById('rp-stock').style.display = 'none';
  document.querySelectorAll('.wl-row').forEach(r => r.classList.remove('row-active'));
  renderFreqTabs(null);
  document.getElementById('right-panel').scrollTop = 0;
}

function sendToTelegram() {
  const BOT_TOKEN = '8258877401:AAGFqN9W9ocB4a5MgCQOf1CmqpJphj1XulE';
  const CHAT_ID   = '8464610734';
  const btn = document.getElementById('tg-btn');

  // í˜„ì¬ ì¢…ëª© ì—†ìœ¼ë©´ ì•ˆë‚´
  if(!currentCode) {
    alert('ë¨¼ì € ì¢…ëª©ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.');
    return;
  }

  const s = getStock(currentCode);
  const dir = s.chg >= 0 ? 'â–²' : 'â–¼';
  const sign = s.chg >= 0 ? '+' : '';
  const aiLabel = { pos:'ğŸŸ¢ ê¸ì •', neg:'ğŸ”´ ë¶€ì •', neu:'âšª ì¤‘ë¦½' }[s.ai.verdict] || 'â€”';
  const feedLines = s.feeds.slice(0,3).map(f =>
    `â€¢ [${f.type.toUpperCase()}] ${f.title}`
  ).join('\n');

  const msg =
`ğŸ“Š *${s.name}* (${s.code})
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¤– AI íŒë‹¨: ${aiLabel}
${s.ai.text}

ğŸ“° ì£¼ìš” ë‰´ìŠ¤/ê³µì‹œ
${feedLines || 'ìˆ˜ì§‘ëœ ë°ì´í„° ì—†ìŒ'}`;

  // ì•„ì´ì½˜ ë¡œë”© í‘œì‹œ
  btn.textContent = 'â³';
  btn.style.pointerEvents = 'none';

  fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      chat_id: CHAT_ID,
      text: msg,
      parse_mode: 'Markdown'
    })
  })
  .then(r => r.json())
  .then(data => {
    if(data.ok) {
      btn.textContent = 'âœ…';
      setTimeout(() => { btn.textContent = 'âœˆ'; btn.style.pointerEvents = ''; }, 2000);
    } else {
      btn.textContent = 'âŒ';
      setTimeout(() => { btn.textContent = 'âœˆ'; btn.style.pointerEvents = ''; }, 2000);
    }
  })
  .catch(() => {
    btn.textContent = 'âŒ';
    setTimeout(() => { btn.textContent = 'âœˆ'; btn.style.pointerEvents = ''; }, 2000);
  });
}

// â”€â”€â”€ ì¢…ëª© ë©”íƒ€ (ì´ë¦„Â·ë“±ë½ í‘œì‹œìš©) â”€â”€â”€
const stockMeta = {
  '005930': { name:'ì‚¼ì„±ì „ì',   chg:-0.62, dir:'dn' },
  '000660': { name:'SKí•˜ì´ë‹‰ìŠ¤', chg:+1.20, dir:'up' },
  '000210': { name:'DL',         chg:-0.88, dir:'dn' },
  '000215': { name:'DLìš°',       chg:-1.14, dir:'dn' },
  '003490': { name:'ëŒ€í•œí•­ê³µ',   chg:+0.45, dir:'up' },
  '003550': { name:'LG',         chg:-0.31, dir:'dn' },
  '003670': { name:'í¬ìŠ¤ì½”í“¨ì²˜ì— ', chg:+2.10, dir:'up' },
  '009830': { name:'í•œí™”ì†”ë£¨ì…˜', chg:-1.55, dir:'dn' },
  '010060': { name:'OCIí™€ë”©ìŠ¤',  chg:+0.90, dir:'up' },
  '011000': { name:'íŒŒë¯¸ì…€',     chg:+3.40, dir:'up' },
  '011070': { name:'LGì´ë…¸í…',   chg:-0.70, dir:'dn' },
  '012630': { name:'HDC',        chg:+1.05, dir:'up' },
  '009150': { name:'ì‚¼ì„±ì „ê¸°',   chg:-0.22, dir:'dn' },
  '086790': { name:'í•˜ë‚˜ê¸ˆìœµì§€ì£¼', chg:+0.33, dir:'up' },
  '010780': { name:'ì•„ì´ì—ìŠ¤ë™ì„œ', chg:-0.50, dir:'dn' },
  '000215': { name:'DLìš°',       chg:-1.14, dir:'dn' },
};

// â”€â”€â”€ ì¡°íšŒ ë¹ˆë„ ì¶”ì  â”€â”€â”€
let viewCount = JSON.parse(localStorage.getItem('dartViewCount') || '{}');

function recordView(code) {
  viewCount[code] = (viewCount[code] || 0) + 1;
  try { localStorage.setItem('dartViewCount', JSON.stringify(viewCount)); } catch(e){}
}

function getTop5() {
  return Object.entries(viewCount)
    .sort((a,b) => b[1]-a[1])
    .slice(0,5)
    .map(([code]) => code);
}

function renderFreqTabs(activeCode) {
  const top5 = getTop5();
  const container = document.getElementById('freq-tabs');
  container.innerHTML = '';

  // ì¡°íšŒ ê¸°ë¡ ì—†ìœ¼ë©´ ì•ˆë‚´ í…ìŠ¤íŠ¸
  if(top5.length === 0) {
    container.innerHTML = '<span style="font-size:10px;color:var(--text3);padding:0 8px;">ìì£¼ ë³¸ ì¢…ëª©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</span>';
    return;
  }

  top5.forEach(code => {
    const m = stockMeta[code];
    if(!m) return;
    const sign = m.chg >= 0 ? '+' : '';
    const btn = document.createElement('button');
    btn.className = 'stock-tab' + (code === activeCode ? ' active' : '');
    btn.dataset.stock = code;
    btn.innerHTML = `${m.name} <span class="chg ${m.dir}">${sign}${m.chg}%</span>`;
    btn.addEventListener('click', () => switchTo(code));
    container.appendChild(btn);
  });
}

// â”€â”€â”€ ì¢…ëª© ìƒì„¸ ë°ì´í„° â”€â”€â”€
const stocks = {
  '005930': {
    name:'ì‚¼ì„±ì „ì', code:'005930', market:'KOSPI',
    price:56100, chg:-350, chgPct:-0.62, vol:'18,241,000',
    per:14.2, pbr:1.08, mcap:'334.8ì¡°', foreign:'51.2%',
    buy:{foreign:-280,inst:-120,retail:400},
    chart:[56800,56600,56900,57100,56950,56700,56500,56300,56200,56100],
    ai:{
      verdict:'neg',
      summary:'ë‹¨ê¸° ë©”ëª¨ë¦¬ ìˆ˜ìš” íšŒë³µ ì§€ì—° ìš°ë ¤. ì™¸êµ­ì¸Â·ê¸°ê´€ ë™ë°˜ ìˆœë§¤ë„. ë‹¨ê¸° ê´€ë§ ìœ ì§€.',
      reasons:[
        { type:'rpt', label:'ë¦¬í¬íŠ¸ ê·¼ê±°', icon:'ğŸ“„', sentiment:'neg',
          body:'<strong>ë¯¸ë˜ì—ì…‹ì¦ê¶Œ</strong>ì´ ë©”ëª¨ë¦¬ ìˆ˜ìš” íšŒë³µ ì§€ì—°ì„ ì´ìœ ë¡œ ëª©í‘œê°€ë¥¼ <span class="neg">70,000 â†’ 62,000ì›</span>ìœ¼ë¡œ í•˜í–¥. 2025ë…„ ì˜ì—…ì´ìµ ì»¨ì„¼ì„œìŠ¤ë„ í•˜í–¥ ì¶”ì„¸.' },
        { type:'news', label:'ë‰´ìŠ¤ ê·¼ê±°', icon:'ğŸ“°', sentiment:'neg',
          body:'<strong>HBM ì‹œì¥ì—ì„œ SKí•˜ì´ë‹‰ìŠ¤ì™€ì˜ ê²©ì°¨ í™•ëŒ€</strong> ë³´ë„ ë‹¤ìˆ˜. ì—”ë¹„ë””ì•„ ê³µê¸‰ë§ ë‚´ ì ìœ ìœ¨ ì••ë°•ì´ ë‹¨ê¸° ì‹¤ì ì— ë¶€ì •ì ìœ¼ë¡œ ì‘ìš©.' },
        { type:'supply', label:'ìˆ˜ê¸‰ ê·¼ê±°', icon:'ğŸ“Š', sentiment:'neg',
          body:'ì™¸êµ­ì¸ <span class="neg">-280ì–µ</span>Â·ê¸°ê´€ <span class="neg">-120ì–µ</span> ë™ë°˜ ìˆœë§¤ë„. ê°œì¸ë§Œ +400ì–µ ë§¤ìˆ˜. ê¸°ê´€ í”„ë¡œê·¸ë¨ ë§¤ë„ ì—°ì† 3ì¼ ì§€ì†.' },
        { type:'dart', label:'ê³µì‹œ ê·¼ê±°', icon:'ğŸ””', sentiment:'neu',
          body:'ìê¸°ì£¼ì‹ ì·¨ë“ ê²°ê³¼ë³´ê³ ì„œ ì œì¶œ í™•ì¸. ì¶”ê°€ì ì¸ ì£¼ì£¼í™˜ì› ì‹ í˜¸ë¡œ í•´ì„ ê°€ëŠ¥í•˜ë‚˜ ë‹¨ê¸° ì£¼ê°€ ë°˜ë“± íŠ¸ë¦¬ê±°ë¡œëŠ” ë¶€ì¡±.' },
      ]
    },
    fin:[
      { label:'ë§¤ì¶œì•¡',   y23:'258.9ì¡°', y24:'300.9ì¡°', y25e:'310.2ì¡°', chg:'up' },
      { label:'ì˜ì—…ì´ìµ', y23:'6.5ì¡°',   y24:'32.7ì¡°',  y25e:'31.4ì¡°',  chg:'dn' },
      { label:'ìˆœì´ìµ',   y23:'15.4ì¡°',  y24:'34.1ì¡°',  y25e:'30.8ì¡°',  chg:'dn' },
      { label:'EPS',      y23:'2,131',   y24:'4,869',   y25e:'4,402',   chg:'dn' },
      { label:'PER',      y23:'26.3x',   y24:'11.5x',   y25e:'12.7x',   chg:'dn' },
      { label:'PBR',      y23:'1.4x',    y24:'1.1x',    y25e:'1.0x',    chg:'dn' },
    ],
    consensus:[
      { firm:'ë¯¸ë˜ì—ì…‹ì¦ê¶Œ', op:'hold', tp:'62,000', analyst:'ê¹€ë¯¼ì¤€', date:'2026-02-21' },
      { firm:'í•˜ë‚˜ì¦ê¶Œ',     op:'hold', tp:'65,000', analyst:'ì´ì„œì—°', date:'2026-02-18' },
      { firm:'í‚¤ì›€ì¦ê¶Œ',     op:'buy',  tp:'75,000', analyst:'ë°•ì§€í›ˆ', date:'2026-02-15' },
      { firm:'NHíˆ¬ìì¦ê¶Œ',  op:'hold', tp:'63,000', analyst:'ìµœìœ ì§„', date:'2026-02-12' },
      { firm:'ì‚¼ì„±ì¦ê¶Œ',    op:'buy',  tp:'70,000', analyst:'ì •íƒœìš°', date:'2026-02-10' },
    ]
  },
  '000660': {
    name:'SKí•˜ì´ë‹‰ìŠ¤', code:'000660', market:'KOSPI',
    price:192400, chg:2300, chgPct:1.20, vol:'4,102,000',
    per:9.8, pbr:1.74, mcap:'139.5ì¡°', foreign:'50.8%',
    buy:{foreign:820,inst:310,retail:-1130},
    chart:[188000,189000,190500,191200,190800,191500,192000,192800,192500,192400],
    ai:{
      verdict:'pos',
      summary:'HBM4 ì–‘ì‚° í™•ì •ìœ¼ë¡œ AI ì„œë²„í–¥ ìˆ˜ìš” ì„ ì . ì™¸êµ­ì¸Â·ê¸°ê´€ ë™ë°˜ ìˆœë§¤ìˆ˜. ëª©í‘œê°€ ìƒí–¥ ì—¬ì§€.',
      reasons:[
        { type:'dart', label:'ê³µì‹œ ê·¼ê±°', icon:'ğŸ””', sentiment:'pos',
          body:'ì´ì‚¬íšŒì—ì„œ <strong>HBM4 ì–‘ì‚° ì¼ì • 2026ë…„ 2ë¶„ê¸° í™•ì •</strong> ê²°ì˜. ì—”ë¹„ë””ì•„Â·AMDÂ·êµ¬ê¸€ 3ì‚¬ì— ìš°ì„  ê³µê¸‰ ê³„ì•½ í¬í•¨. ì§ì ‘ì ì¸ ì‹¤ì  ê°€ì‹œì„± í™•ë³´.' },
        { type:'rpt', label:'ë¦¬í¬íŠ¸ ê·¼ê±°', icon:'ğŸ“„', sentiment:'pos',
          body:'<strong>í‚¤ì›€ì¦ê¶Œ</strong> AI ì„œë²„ DRAM ìˆ˜ìš” í­ì¦ â†’ ëª©í‘œê°€ <span class="pos">230,000ì› ìœ ì§€</span>. HBM3E ë§ˆì§„ìœ¨ 40%+ ì¶”ì •. 2026ë…„ ì˜ì—…ì´ìµ ì»¨ì„¼ì„œìŠ¤ ìƒí–¥ ì¶”ì„¸.' },
        { type:'news', label:'ë‰´ìŠ¤ ê·¼ê±°', icon:'ğŸ“°', sentiment:'pos',
          body:'ì—”ë¹„ë””ì•„ H200 ê³µê¸‰ë§ ë‚´ <strong>ì ìœ ìœ¨ 80% ì´ìƒ ìœ ì§€</strong> ë³´ë„. ê²½ìŸì‚¬ HBM ìˆ˜ìœ¨ ë¬¸ì œë¡œ SKí•˜ì´ë‹‰ìŠ¤ ë…ì ì  ì§€ìœ„ ì§€ì† ì „ë§.' },
        { type:'supply', label:'ìˆ˜ê¸‰ ê·¼ê±°', icon:'ğŸ“Š', sentiment:'pos',
          body:'ì™¸êµ­ì¸ <span class="pos">+820ì–µ</span>Â·ê¸°ê´€ <span class="pos">+310ì–µ</span> ë™ë°˜ ìˆœë§¤ìˆ˜. ê°œì¸ì€ -1,130ì–µ ì°¨ìµì‹¤í˜„. ê¸°ê´€ ë§¤ìˆ˜ 4ì¼ ì—°ì† ì§€ì† ì¤‘.' },
      ]
    },
    fin:[
      { label:'ë§¤ì¶œì•¡',   y23:'32.8ì¡°',  y24:'66.1ì¡°',  y25e:'89.4ì¡°',  chg:'up' },
      { label:'ì˜ì—…ì´ìµ', y23:'-7.7ì¡°',  y24:'23.5ì¡°',  y25e:'38.2ì¡°',  chg:'up' },
      { label:'ìˆœì´ìµ',   y23:'-9.8ì¡°',  y24:'19.7ì¡°',  y25e:'32.1ì¡°',  chg:'up' },
      { label:'EPS',      y23:'-13,465', y24:'26,900',  y25e:'43,800',  chg:'up' },
      { label:'PER',      y23:'N/A',     y24:'7.1x',    y25e:'4.4x',    chg:'up' },
      { label:'PBR',      y23:'1.8x',    y24:'1.7x',    y25e:'1.4x',    chg:'up' },
    ],
    consensus:[
      { firm:'í‚¤ì›€ì¦ê¶Œ',    op:'buy', tp:'230,000', analyst:'ì´ë¯¼í˜¸', date:'2026-02-21' },
      { firm:'ë¯¸ë˜ì—ì…‹ì¦ê¶Œ', op:'buy', tp:'220,000', analyst:'ê¹€íƒœì˜', date:'2026-02-19' },
      { firm:'í•˜ë‚˜ì¦ê¶Œ',    op:'buy', tp:'215,000', analyst:'ë°•ìˆ˜ë¹ˆ', date:'2026-02-17' },
      { firm:'ì‚¼ì„±ì¦ê¶Œ',   op:'buy', tp:'225,000', analyst:'ìµœì¤€í˜', date:'2026-02-14' },
    ]
  },
  '003670': {
    name:'í¬ìŠ¤ì½”í“¨ì²˜ì— ', code:'003670', market:'KOSPI',
    price:143200, chg:2950, chgPct:2.10, vol:'912,000',
    per:42.1, pbr:2.30, mcap:'20.3ì¡°', foreign:'18.4%',
    buy:{foreign:150,inst:88,retail:-238},
    chart:[138000,139500,140200,141000,140800,141500,142000,143000,143500,143200],
    ai:{
      verdict:'pos',
      summary:'GMÂ·í¬ë“œ ì „ê³ ì²´ ë°°í„°ë¦¬ í˜‘ì•½ ìˆ˜í˜œ. ìŒê·¹ì¬Â·ì–‘ê·¹ì¬ ë™ë°˜ ì„±ì¥ ê°€ì‹œí™”. ë‹¨ê¸° ê³¼ì—´ ì£¼ì˜.',
      reasons:[
        { type:'news', label:'ë‰´ìŠ¤ ê·¼ê±°', icon:'ğŸ“°', sentiment:'pos',
          body:'GMÂ·í¬ë“œê°€ <strong>ì „ê³ ì²´ ë°°í„°ë¦¬ í•©ì‚° ê³µê¸‰ í˜‘ì•½</strong>ì„ í¬ìŠ¤ì½”í“¨ì²˜ì— ê³¼ ì²´ê²°. 2027ë…„ë¶€í„° ì—°ê°„ 30GWh ê³µê¸‰ ì˜ˆì •. ì¥ê¸° ì‹¤ì  ê°€ì‹œì„± ëŒ€í­ ê°œì„ .' },
        { type:'rpt', label:'ë¦¬í¬íŠ¸ ê·¼ê±°', icon:'ğŸ“„', sentiment:'pos',
          body:'<strong>ì‚¼ì„±ì¦ê¶Œ</strong> ìŒê·¹ì¬ ì¦ì„¤ ì™„ë£Œ â†’ ëª©í‘œê°€ <span class="pos">175,000ì›</span>. ì–‘ê·¹ì¬ë„ 2026ë…„ í•˜ë°˜ê¸° ìºíŒŒ 2ë°° í™•ëŒ€ ì˜ˆì •. ì¤‘ì¥ê¸° ì„±ì¥ ì—¬ì „íˆ ìœ íš¨.' },
        { type:'supply', label:'ìˆ˜ê¸‰ ê·¼ê±°', icon:'ğŸ“Š', sentiment:'neu',
          body:'ì™¸êµ­ì¸ <span class="pos">+150ì–µ</span>Â·ê¸°ê´€ <span class="pos">+88ì–µ</span> ì†Œí­ ìˆœë§¤ìˆ˜. ë‹¨ê¸° ê¸‰ë“± í›„ ê°œì¸ <span class="neg">-238ì–µ</span> ì°¨ìµì‹¤í˜„. ê³¼ì—´ êµ¬ê°„ ì§„ì… ì—¬ë¶€ ëª¨ë‹ˆí„°ë§ í•„ìš”.' },
      ]
    },
    fin:[
      { label:'ë§¤ì¶œì•¡',   y23:'4.3ì¡°', y24:'5.8ì¡°',  y25e:'8.1ì¡°',  chg:'up' },
      { label:'ì˜ì—…ì´ìµ', y23:'0.1ì¡°', y24:'0.2ì¡°',  y25e:'0.5ì¡°',  chg:'up' },
      { label:'ìˆœì´ìµ',   y23:'0.1ì¡°', y24:'0.2ì¡°',  y25e:'0.4ì¡°',  chg:'up' },
      { label:'EPS',      y23:'520',   y24:'1,240',  y25e:'2,800',  chg:'up' },
      { label:'PER',      y23:'N/A',   y24:'115x',   y25e:'51x',    chg:'up' },
      { label:'PBR',      y23:'3.1x',  y24:'2.5x',   y25e:'2.3x',  chg:'up' },
    ],
    consensus:[
      { firm:'ì‚¼ì„±ì¦ê¶Œ',    op:'buy',  tp:'175,000', analyst:'ì´ìœ ì§„', date:'2026-02-21' },
      { firm:'NHíˆ¬ìì¦ê¶Œ', op:'buy',  tp:'168,000', analyst:'ê¹€ë™í˜„', date:'2026-02-18' },
      { firm:'í•˜ë‚˜ì¦ê¶Œ',   op:'hold', tp:'145,000', analyst:'ë°•ë¯¼ì„œ', date:'2026-02-15' },
    ]
  },
  '009830': {
    name:'í•œí™”ì†”ë£¨ì…˜', code:'009830', market:'KOSPI',
    price:25450, chg:-400, chgPct:-1.55, vol:'1,512,000',
    per:18.4, pbr:0.72, mcap:'4.2ì¡°', foreign:'9.1%',
    buy:{foreign:-95,inst:-60,retail:155},
    chart:[26200,26100,25900,26000,25800,25700,25600,25500,25400,25450],
    ai:{
      verdict:'neg',
      summary:'IRA ì§€ì› ì¶•ì†Œë¡œ íƒœì–‘ê´‘ ì„¹í„° ì•½ì„¸. ì™¸êµ­ì¸Â·ê¸°ê´€ ë™ë°˜ ë§¤ë„. ë°˜ë“± íŠ¸ë¦¬ê±° ë¶€ì¬.',
      reasons:[
        { type:'news', label:'ë‰´ìŠ¤ ê·¼ê±°', icon:'ğŸ“°', sentiment:'neg',
          body:'ë¯¸êµ­ IRA íƒœì–‘ê´‘ ì„¸ì•¡ê³µì œ <strong>í•œí™”ì†”ë£¨ì…˜ ì ìš©ë¶„ 30% ì¶•ì†Œ</strong> ê°€ëŠ¥ì„± ë³´ë„. ë¯¸êµ­ ì‚¬ì—… ë§¤ì¶œ ë¹„ì¤‘ 40% ê°ì•ˆ ì‹œ ì‹¤ì  íƒ€ê²© ë¶ˆê°€í”¼.' },
        { type:'rpt', label:'ë¦¬í¬íŠ¸ ê·¼ê±°', icon:'ğŸ“„', sentiment:'neg',
          body:'<strong>NHíˆ¬ìì¦ê¶Œ</strong> ì—…í™© ì•…í™” ë°˜ì˜, ëª©í‘œê°€ <span class="neg">30,000 â†’ 26,000ì›</span> í•˜í–¥. 2025ë…„ ì˜ì—…ì´ìµ ì¶”ì •ì¹˜ -35% í•˜í–¥ ì¡°ì •.' },
        { type:'supply', label:'ìˆ˜ê¸‰ ê·¼ê±°', icon:'ğŸ“Š', sentiment:'neg',
          body:'ì™¸êµ­ì¸ <span class="neg">-95ì–µ</span>Â·ê¸°ê´€ <span class="neg">-60ì–µ</span> ë™ë°˜ ë§¤ë„. ê°œì¸ë§Œ +155ì–µ ì €ê°€ ë§¤ìˆ˜. ê¸°ê´€ ë§¤ë„ 9ì¼ ì—°ì†. ìˆ˜ê¸‰ ê°œì„  ì‹œê·¸ë„ ì—†ìŒ.' },
      ]
    },
    fin:[
      { label:'ë§¤ì¶œì•¡',   y23:'10.2ì¡°', y24:'9.8ì¡°',  y25e:'9.1ì¡°',  chg:'dn' },
      { label:'ì˜ì—…ì´ìµ', y23:'0.5ì¡°',  y24:'0.3ì¡°',  y25e:'0.2ì¡°',  chg:'dn' },
      { label:'ìˆœì´ìµ',   y23:'0.4ì¡°',  y24:'0.2ì¡°',  y25e:'0.1ì¡°',  chg:'dn' },
      { label:'EPS',      y23:'2,450',  y24:'1,230',  y25e:'620',    chg:'dn' },
      { label:'PER',      y23:'10.4x',  y24:'20.7x',  y25e:'41x',    chg:'dn' },
      { label:'PBR',      y23:'0.9x',   y24:'0.8x',   y25e:'0.7x',  chg:'dn' },
    ],
    consensus:[
      { firm:'NHíˆ¬ìì¦ê¶Œ', op:'hold', tp:'26,000', analyst:'ìµœì„±í›ˆ', date:'2026-02-21' },
      { firm:'ë¯¸ë˜ì—ì…‹ì¦ê¶Œ', op:'hold', tp:'28,000', analyst:'ì´ì§€ì€', date:'2026-02-17' },
      { firm:'í‚¤ì›€ì¦ê¶Œ',   op:'sell', tp:'22,000', analyst:'ë°•ì¤€í˜¸', date:'2026-02-13' },
    ]
  },
  '003490': {
    name:'ëŒ€í•œí•­ê³µ', code:'003490', market:'KOSPI',
    price:22200, chg:100, chgPct:0.45, vol:'1,800,000',
    per:11.2, pbr:0.98, mcap:'9.1ì¡°', foreign:'22.5%',
    buy:{foreign:42,inst:-10,retail:-32},
    chart:[21900,22000,21950,22100,22050,22150,22200,22180,22220,22200],
    ai:{
      verdict:'pos',
      summary:'ì•„ì‹œì•„ë‚˜ í†µí•© ì‹œë„ˆì§€ ë³¸ê²©í™”. ëª©í‘œê°€ 28,000 ìœ ì§€. êµ­ì œì„  ìˆ˜ìš” íšŒë³µ ì§€ì†.',
      reasons:[
        { type:'rpt', label:'ë¦¬í¬íŠ¸ ê·¼ê±°', icon:'ğŸ“„', sentiment:'pos',
          body:'<strong>í•˜ë‚˜ì¦ê¶Œ</strong> ì•„ì‹œì•„ë‚˜í•­ê³µ í†µí•© ì™„ë£Œë¡œ ë…¸ì„  ì ìœ ìœ¨ <span class="pos">+15%p</span> ìƒìŠ¹ ì¶”ì •. ëª©í‘œê°€ 28,000 ìœ ì§€. 2026ë…„ ì˜ì—…ì´ìµ 1.2ì¡° ì˜ˆìƒ.' },
        { type:'news', label:'ë‰´ìŠ¤ ê·¼ê±°', icon:'ğŸ“°', sentiment:'pos',
          body:'êµ­ì œì„  ì—¬ê° ìˆ˜ìš” YoY <strong>+18% íšŒë³µ</strong>. ì¼ë³¸Â·ë™ë‚¨ì•„ ë…¸ì„  íƒ‘ìŠ¹ë¥  92% ìƒíšŒ. í™”ë¬¼ ë¶€ë¬¸ë„ ì „ììƒê±°ë˜ ìˆ˜ìš”ë¡œ ê²¬ì¡°í•œ íë¦„ ìœ ì§€.' },
        { type:'supply', label:'ìˆ˜ê¸‰ ê·¼ê±°', icon:'ğŸ“Š', sentiment:'neu',
          body:'ì™¸êµ­ì¸ <span class="pos">+42ì–µ</span> ì†Œí­ ìˆœë§¤ìˆ˜. ê¸°ê´€ -10ì–µÂ·ê°œì¸ -32ì–µìœ¼ë¡œ í˜¼ì¡°. ì „ë°˜ì ìœ¼ë¡œ ê´€ë§ì„¸. ì¶”ê°€ ìƒìŠ¹ì„ ìœ„í•œ ëª¨ë©˜í…€ í•„ìš”.' },
      ]
    },
    fin:[
      { label:'ë§¤ì¶œì•¡',   y23:'15.9ì¡°', y24:'17.2ì¡°', y25e:'19.8ì¡°', chg:'up' },
      { label:'ì˜ì—…ì´ìµ', y23:'1.4ì¡°',  y24:'1.1ì¡°',  y25e:'1.2ì¡°',  chg:'up' },
      { label:'ìˆœì´ìµ',   y23:'1.1ì¡°',  y24:'0.9ì¡°',  y25e:'1.0ì¡°',  chg:'up' },
      { label:'EPS',      y23:'2,850',  y24:'2,310',  y25e:'2,580',  chg:'up' },
      { label:'PER',      y23:'7.8x',   y24:'9.6x',   y25e:'8.6x',  chg:'up' },
      { label:'PBR',      y23:'1.2x',   y24:'1.0x',   y25e:'1.0x',  chg:'neu' },
    ],
    consensus:[
      { firm:'í•˜ë‚˜ì¦ê¶Œ',    op:'buy',  tp:'28,000', analyst:'ê¹€ì§€ìˆ˜', date:'2026-02-21' },
      { firm:'ì‚¼ì„±ì¦ê¶Œ',   op:'buy',  tp:'27,000', analyst:'ì´í˜„ìš°', date:'2026-02-18' },
      { firm:'NHíˆ¬ìì¦ê¶Œ', op:'hold', tp:'24,000', analyst:'ë°•ì„¸ì¤€', date:'2026-02-14' },
    ]
  }
};

function getStock(code) {
  return stocks[code] || { name:code, code, market:'KOSPI', price:0, chg:0, chgPct:0, vol:'-', per:'-', pbr:'-', mcap:'-', foreign:'-', buy:{foreign:0,inst:0,retail:0}, chart:[0,0,0,0,0,0,0,0,0,0], ai:{verdict:'neu',text:'ë°ì´í„° ìˆ˜ì‹  ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.'}, feeds:[] };
}

function miniChart(prices, dir) {
  const w=312,h=54, min=Math.min(...prices), max=Math.max(...prices), range=max-min||1;
  const pts=prices.map((p,i)=>`${(i/(prices.length-1))*w},${h-((p-min)/range)*(h-6)-2}`).join(' ');
  const c=dir==='up'?'#4ea870':'#a84848';
  const last=pts.split(' ').pop().split(',');
  return `<svg viewBox="0 0 ${w} ${h}" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="cg" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="${c}" stop-opacity="0.25"/><stop offset="100%" stop-color="${c}" stop-opacity="0"/></linearGradient></defs><polygon points="0,${h} ${pts} ${w},${h}" fill="url(#cg)"/><polyline points="${pts}" fill="none" stroke="${c}" stroke-width="1.5"/><circle cx="${last[0]}" cy="${last[1]}" r="3" fill="${c}"/></svg>`;
}

function buildDetail(code) {
  const s=getStock(code);
  const dir=s.chg>=0?'up':'dn';
  const sign=s.chg>=0?'+':'';
  const tf=Math.abs(s.buy.foreign)+Math.abs(s.buy.inst)+Math.abs(s.buy.retail)||1;
  const bPct=s.buy.foreign>0?(s.buy.foreign/tf*100):0;
  const sPct=s.buy.foreign<0?(-s.buy.foreign/tf*100):0;
  const aiLabel={'pos':'â–² ê¸ì •','neg':'â–¼ ë¶€ì •','neu':'â€” ì¤‘ë¦½'}[s.ai.verdict];

  // íƒ­1: AI íŒë‹¨ ê·¼ê±°
  const reasonsHtml = (s.ai.reasons||[]).map(r => `
    <div class="ai-reason-item">
      <div class="ai-reason-top">
        <span class="ai-reason-icon">${r.icon}</span>
        <span class="ai-reason-label">${r.label}</span>
        <span class="ai-reason-badge"><span class="feed-ai-badge ${r.sentiment}">${r.sentiment==='pos'?'â–² ê¸ì •':r.sentiment==='neg'?'â–¼ ë¶€ì •':'â€” ì¤‘ë¦½'}</span></span>
      </div>
      <div class="ai-reason-body">${r.body}</div>
    </div>`).join('') || '<div style="padding:14px;font-size:11px;color:var(--text3)">ë°ì´í„° ì—†ìŒ</div>';

  // íƒ­2: ì¬ë¬´
  const finHtml = `<table class="fin-table">
    <thead><tr><th>í•­ëª©</th><th>2023A</th><th>2024A</th><th>2025E</th></tr></thead>
    <tbody>${(s.fin||[]).map(f=>`
    <tr><td>${f.label}</td><td>${f.y23}</td><td>${f.y24}</td><td class="${f.chg}">${f.y25e}</td></tr>`).join('')}
    </tbody></table>`;

  // íƒ­3: ì»¨ì„¼ì„œìŠ¤
  const consHtml = (s.consensus||[]).map(c=>`
    <div class="cons-item">
      <div class="cons-top">
        <span class="cons-firm">${c.firm}</span>
        <span class="cons-op ${c.op}">${c.op==='buy'?'ë§¤ìˆ˜':c.op==='sell'?'ë§¤ë„':'ì¤‘ë¦½'}</span>
      </div>
      <div class="cons-tp">TP &nbsp;<strong>${Number(c.tp).toLocaleString()}ì›</strong></div>
      <div class="cons-analyst">${c.analyst} Â· ${c.date}</div>
    </div>`).join('') || '<div style="padding:14px;font-size:11px;color:var(--text3)">ë°ì´í„° ì—†ìŒ</div>';

  return `
  <div class="sd-header">
    <div class="sd-name-row">
      <div><div class="sd-name">${s.name}</div><div class="sd-code">${s.code} Â· ${s.market}</div></div>
      <div class="sd-price-block">
        <div class="sd-price ${dir}">${s.price.toLocaleString()}</div>
        <div class="sd-chg ${dir}">${sign}${s.chg.toLocaleString()} (${sign}${s.chgPct}%)</div>
      </div>
    </div>
    <div class="sd-chart">${miniChart(s.chart,dir)}</div>
    <div class="sd-metrics">
      <div class="sd-metric"><div class="sd-metric-label">PER</div><div class="sd-metric-val">${s.per}x</div></div>
      <div class="sd-metric"><div class="sd-metric-label">PBR</div><div class="sd-metric-val">${s.pbr}x</div></div>
      <div class="sd-metric"><div class="sd-metric-label">ì‹œì´</div><div class="sd-metric-val">${s.mcap}</div></div>
      <div class="sd-metric"><div class="sd-metric-label">ì™¸êµ­ì¸</div><div class="sd-metric-val">${s.foreign}</div></div>
    </div>
  </div>
  <div class="sd-supply">
    <div class="sd-supply-title">ìˆ˜ê¸‰ (ë‹¹ì¼)</div>
    <div class="sd-supply-row"><span class="sd-supply-label">ì™¸êµ­ì¸</span><span class="sd-supply-val ${s.buy.foreign>=0?'buy':'sell'}">${s.buy.foreign>=0?'+':''}${s.buy.foreign.toLocaleString()}ì–µ</span></div>
    <div class="sd-supply-row"><span class="sd-supply-label">ê¸°ê´€</span><span class="sd-supply-val ${s.buy.inst>=0?'buy':'sell'}">${s.buy.inst>=0?'+':''}${s.buy.inst.toLocaleString()}ì–µ</span></div>
    <div class="sd-supply-row"><span class="sd-supply-label">ê°œì¸</span><span class="sd-supply-val ${s.buy.retail>=0?'buy':'sell'}">${s.buy.retail>=0?'+':''}${s.buy.retail.toLocaleString()}ì–µ</span></div>
    <div class="sd-supply-bars"><div class="sd-supply-bar-buy" style="width:${bPct}%"></div><div class="sd-supply-bar-sell" style="width:${sPct}%"></div></div>
  </div>
  <div class="sd-ai">
    <div class="sd-ai-label">AI ì¢…í•© íŒë‹¨</div>
    <div class="sd-ai-verdict ${s.ai.verdict}">${aiLabel}</div>
    <div class="sd-ai-text">${s.ai.summary}</div>
  </div>
  <div class="sd-tabs" id="sd-tabs">
    <div class="sd-tab active" onclick="switchDetailTab(this,'tab-reasons')">íŒë‹¨ ê·¼ê±°</div>
    <div class="sd-tab" onclick="switchDetailTab(this,'tab-fin')">ì¬ë¬´</div>
    <div class="sd-tab" onclick="switchDetailTab(this,'tab-cons')">ì»¨ì„¼ì„œìŠ¤</div>
  </div>
  <div class="tab-content active" id="tab-reasons">${reasonsHtml}</div>
  <div class="tab-content" id="tab-fin">${finHtml}</div>
  <div class="tab-content" id="tab-cons">${consHtml}</div>`;
}

function switchDetailTab(el, targetId) {
  el.closest('.sd-tabs').querySelectorAll('.sd-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
  const target = document.getElementById(targetId);
  if(target) target.classList.add('active');
}

let currentCode = null;

function switchTo(code) {
  currentCode = code;

  // ì¡°íšŒ ë¹ˆë„ ê¸°ë¡
  recordView(code);

  // ì›Œì¹˜ë¦¬ìŠ¤íŠ¸ í–‰ í•˜ì´ë¼ì´íŠ¸
  document.querySelectorAll('.wl-row').forEach(r=>r.classList.remove('row-active'));
  const row=document.querySelector(`.wl-row[data-stock="${code}"]`);
  if(row) row.classList.add('row-active');

  // ìƒì„¸ íŒ¨ë„
  const rpM=document.getElementById('rp-market');
  const rpS=document.getElementById('rp-stock');
  rpM.style.display='none';
  rpS.style.display='';
  rpS.innerHTML=buildDetail(code);
  document.getElementById('right-panel').scrollTop=0;

  // íƒ­ ì¬ë Œë” (top5 ê°±ì‹ )
  renderFreqTabs(code);
}

// ì›Œì¹˜ë¦¬ìŠ¤íŠ¸ í–‰ í´ë¦­
document.querySelectorAll('.wl-row').forEach(row=>{
  row.addEventListener('click',()=>switchTo(row.dataset.stock));
});

// ê²€ìƒ‰ì°½ â€” ì¢…ëª©ëª… ë˜ëŠ” ì½”ë“œ ì…ë ¥ ì‹œ ì´ë™
const searchInput = document.querySelector('.search-input');
searchInput.addEventListener('keydown', e => {
  if(e.key !== 'Enter') return;
  const q = e.target.value.trim();
  if(!q) return;

  // ì½”ë“œëª… ë˜ëŠ” ì¢…ëª©ëª…ìœ¼ë¡œ ê²€ìƒ‰
  const found = Object.entries(stockMeta).find(([code, m]) =>
    code === q || m.name.includes(q)
  );

  if(found) {
    switchTo(found[0]);
    e.target.value = '';
    e.target.blur();
  } else {
    e.target.style.borderColor = 'var(--red)';
    setTimeout(() => e.target.style.borderColor = '', 1000);
  }
});

// ì…ë ¥ ì¤‘ ì‹¤ì‹œê°„ í•˜ì´ë¼ì´íŠ¸ (ë“œë¡­ë‹¤ìš´ ì—†ì´ í…Œë‘ë¦¬ ìƒ‰ìœ¼ë¡œ í”¼ë“œë°±)
searchInput.addEventListener('input', e => {
  const q = e.target.value.trim();
  if(!q) { e.target.style.borderColor = ''; return; }
  const found = Object.entries(stockMeta).find(([code, m]) =>
    code === q || m.name.includes(q)
  );
  e.target.style.borderColor = found ? 'var(--green)' : 'var(--border)';
});

// â”€â”€â”€ ì„œë²„ ì—°ê²° & ì‹¤ì‹œê°„ í”¼ë“œ â”€â”€â”€
const SERVER = 'http://localhost:3000';
let allFeedItems = [];
let currentFilter = 'all';

function fmtTime(dateStr) {
  if (!dateStr) return '';
  try {
    const d = new Date(dateStr);
    if (isNaN(d)) return dateStr.slice(0,10) || '';
    return d.toLocaleTimeString('ko-KR', { hour:'2-digit', minute:'2-digit' });
  } catch(e) { return ''; }
}

function renderFeed(items) {
  const c = document.getElementById('live-feed-container');
  if (!items || items.length === 0) {
    c.innerHTML = '<div style="padding:20px 14px;text-align:center;color:var(--text3);font-size:11px;">ìˆ˜ì§‘ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
    return;
  }
  const filtered = currentFilter === 'all' ? items : items.filter(i => i._type === currentFilter);
  c.innerHTML = filtered.slice(0, 80).map(item => {
    const tagClass = item._type === 'dart' ? 'dart' : item._type === 'rpt' ? 'rpt' : 'news';
    const tagLabel = item._type === 'dart' ? 'DART' : item._type === 'rpt' ? 'REPORT' : 'NEWS';
    const ticker = item.corp || item.ticker || '';
    const title  = item.title || item.report_nm || '';
    const source = item.source || item.src || '';
    const time   = fmtTime(item.date || item.pubDate || item.rcept_dt);
    const link   = item.link || item.url || '#';
    const aiResult = item.aiResult;
    const aiBadge = aiResult
      ? `<span class="feed-ai-badge ${aiResult.sentiment === 'ê¸ì •' ? 'pos' : aiResult.sentiment === 'ë¶€ì •' ? 'neg' : 'neu'}">AI ${aiResult.sentiment === 'ê¸ì •' ? 'â–² ê¸ì •' : aiResult.sentiment === 'ë¶€ì •' ? 'â–¼ ë¶€ì •' : 'â€” ì¤‘ë¦½'}</span>`
      : '';
    return `<div class="feed-item" onclick="window.open('${link}','_blank')">
      <div class="feed-time">${time}</div>
      <div class="feed-body">
        <div class="feed-top">
          <span class="tag ${tagClass}">${tagLabel}</span>
          ${ticker ? `<span class="feed-ticker">${ticker}</span>` : ''}
        </div>
        <div class="feed-title">${title}</div>
        <div class="feed-meta"><span>${source}</span>${aiBadge}</div>
      </div>
    </div>`;
  }).join('');
}

function filterFeed(type) {
  currentFilter = type;
  renderFeed(allFeedItems);
}

async function loadLiveFeed() {
  const statusEl = document.getElementById('server-status');
  const container = document.getElementById('live-feed-container');

  try {
    // ì„œë²„ ìƒíƒœ í™•ì¸
    const statusRes = await fetch(`${SERVER}/api/status`, { signal: AbortSignal.timeout(3000) });
    if (!statusRes.ok) throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
    const status = await statusRes.json();

    statusEl.textContent = `âœ“ ì—°ê²°ë¨ Â· ë‰´ìŠ¤${status.news}ê±´ Â· ë¦¬í¬íŠ¸${status.reports}ê±´`;
    statusEl.style.color = 'var(--green)';
    statusEl.style.borderColor = 'var(--green2)';

    container.innerHTML = '<div style="padding:12px 14px;color:var(--text3);font-size:11px;">ë°ì´í„° ë¡œë”© ì¤‘...</div>';

    // ë‰´ìŠ¤ + ë¦¬í¬íŠ¸ ë³‘ë ¬ ìš”ì²­
    const [newsRes, rptRes] = await Promise.allSettled([
      fetch(`${SERVER}/api/stored-news`).then(r => r.json()),
      fetch(`${SERVER}/api/stored-reports`).then(r => r.json()),
    ]);

    const newsItems = (newsRes.status === 'fulfilled' ? newsRes.value.items || [] : [])
      .map(n => ({ ...n, _type: 'news' }));

    const rptItems = (rptRes.status === 'fulfilled' ? rptRes.value.items || [] : [])
      .map(r => ({ ...r, _type: 'rpt' }));

    // DART ê³µì‹œ (ì˜¤ëŠ˜ ë‚ ì§œ)
    let dartItems = [];
    try {
      const today = new Date();
      const kst = new Date(today.getTime() + 9*3600000);
      const yyyymmdd = kst.toISOString().slice(0,10).replace(/-/g,'');
      const dartRes = await fetch(`${SERVER}/api/dart?date=${yyyymmdd}`).then(r => r.json());
      dartItems = (dartRes.list || []).map(d => ({
        ...d, _type:'dart', title: d.report_nm, corp: d.corp_name,
        date: d.rcept_dt, link: `https://dart.fss.or.kr/dsaf001/main.do?rcpNo=${d.rcept_no}`
      }));
    } catch(e) {}

    // í•©ì¹˜ê³  ë‚ ì§œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
    allFeedItems = [...dartItems, ...newsItems, ...rptItems].sort((a,b) => {
      const da = a.date || a.pubDate || '';
      const db = b.date || b.pubDate || '';
      return db.localeCompare(da);
    });

    renderFeed(allFeedItems);

  } catch(e) {
    statusEl.textContent = 'âœ— ì„œë²„ ì˜¤í”„ë¼ì¸';
    statusEl.style.color = 'var(--red)';
    statusEl.style.borderColor = '#5a2222';
    container.innerHTML = `<div style="padding:20px 14px;text-align:center;color:var(--text3);font-size:11px;">
      ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br>
      <span style="font-size:10px;margin-top:4px;display:block">DART Monitorê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ ì£¼ì„¸ìš” (localhost:3000)</span>
    </div>`;
  }
}

// ì´ˆê¸° ë Œë”
renderFreqTabs(null);
switchTo('005930');
loadLiveFeed(); // ì„œë²„ ë°ì´í„° ë¡œë“œ

// 3ë¶„ë§ˆë‹¤ ìë™ ê°±ì‹ 
setInterval(loadLiveFeed, 3 * 60 * 1000);

(function tick(){
  const now=new Date();
  const h=String(now.getHours()).padStart(2,'0');
  const m=String(now.getMinutes()).padStart(2,'0');
  document.getElementById('ts-label').textContent=`2026-02-22 Â· ${h}:${m} Â· ì¥í›„`;
  setTimeout(tick,30000);
})();
</script>
</body>
</html>
